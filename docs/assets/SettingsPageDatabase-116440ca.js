import{r as o,j as e,Q as c,aa as w,bo as S,e as k}from"./vendor-558e3516.js";import{a as C,u as P,B as f,w as E,x as I,y as U,z as B}from"./admin-f4ec72c8.js";import"./vendor-misc-0d9f0c57.js";import"./ui-675b1de5.js";const z=()=>{const{user:l}=C(),{toast:n}=P(),[m,u]=o.useState(!1),[j,h]=o.useState(!0);o.useState("profile");const[d,p]=o.useState(!1),[r,i]=o.useState({full_name:"",email:"",phone:"",bio:"",grade_level:"",school_name:"",age:"",interested_fields:[],avatar_url:""});o.useState({theme:"light",language:"th",compact_mode:!1,animations_enabled:!0}),o.useState({email_notifications:!0,push_notifications:!0,course_updates:!0,assignment_reminders:!0,forum_notifications:!1,sound_enabled:!0}),o.useEffect(()=>{(async()=>{var t;if(l){h(!0);try{const s=await E();s.data?i({full_name:s.data.full_name||((t=l.user_metadata)==null?void 0:t.full_name)||"",email:l.email||"",phone:s.data.phone||"",bio:s.data.bio||"",grade_level:s.data.grade_level||"",school_name:s.data.school_name||"",age:s.data.age||"",interested_fields:s.data.interested_fields||[],avatar_url:s.data.avatar_url||""}):i(x=>{var g;return{...x,email:l.email||"",full_name:((g=l.user_metadata)==null?void 0:g.full_name)||""}}),s.data&&Object.keys(s.data).length>0&&n({title:"โหลดการตั้งค่าสำเร็จ",description:"ข้อมูลโปรไฟล์ของคุณถูกโหลดจากฐานข้อมูล"})}catch(s){console.error("Error loading settings:",s),n({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดการตั้งค่าได้",variant:"destructive"})}finally{h(!1)}}})()},[l,n]);const v=async a=>{const t=a.target.files[0];if(t){p(!0);try{const{data:s,error:x}=await U(t);if(x)throw new Error(x.message||"ไม่สามารถอัปโหลดรูปภาพได้");i(g=>({...g,avatar_url:s.publicUrl})),n({title:"อัปโหลดรูปภาพสำเร็จ",description:"รูปโปรไฟล์ของคุณได้รับการอัปเดทแล้ว"}),await b()}catch(s){console.error("Error uploading profile image:",s),n({title:"เกิดข้อผิดพลาด",description:s.message,variant:"destructive"})}finally{p(!1),a.target.value=""}}},b=async()=>{if(l){u(!0);try{const{email:a,...t}=r,{error:s}=await B(t);if(s)throw new Error(s);n({title:"บันทึกสำเร็จ",description:"ข้อมูลโปรไฟล์ของคุณได้รับการอัพเดทแล้ว"})}catch(a){console.error("Error saving profile:",a),n({title:"เกิดข้อผิดพลาด",description:`ไม่สามารถบันทึกข้อมูลได้: ${a.message}`,variant:"destructive"})}finally{u(!1)}}},y=async()=>{var a;if(l&&window.confirm("คุณแน่ใจหรือไม่ที่จะล้างข้อมูลโปรไฟล์ทั้งหมด?")){u(!0);try{const{error:t}=await I();if(t)throw new Error(t);i({full_name:((a=l.user_metadata)==null?void 0:a.full_name)||"",email:l.email||"",phone:"",bio:"",grade_level:"",school_name:"",age:"",interested_fields:[],avatar_url:""}),n({title:"ล้างข้อมูลสำเร็จ",description:"ข้อมูลโปรไฟล์ทั้งหมดถูกลบออกจากฐานข้อมูลแล้ว"})}catch(t){console.error("Error clearing settings:",t),n({title:"เกิดข้อผิดพลาด",description:`ไม่สามารถล้างข้อมูลได้: ${t.message}`,variant:"destructive"})}finally{u(!1)}}};if(j)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(c,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"กำลังโหลดการตั้งค่า..."})]})});const N=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"ข้อมูลโปรไฟล์"}),e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"w-20 h-20 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:[r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(w,{className:"w-8 h-8 text-gray-400"}),d&&e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-full",children:e.jsx(c,{className:"w-6 h-6 text-white animate-spin"})})]}),e.jsx("input",{type:"file",id:"profile-image-upload",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:v,className:"hidden",disabled:d}),e.jsx(f,{size:"sm",variant:"outline",className:"absolute -bottom-1 -right-1 rounded-full w-8 h-8 p-0",onClick:()=>{var a;return(a=document.getElementById("profile-image-upload"))==null?void 0:a.click()},disabled:d,children:d?e.jsx(c,{className:"w-4 h-4 animate-spin"}):e.jsx(S,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"รูปโปรไฟล์"}),e.jsx("p",{className:"text-sm text-gray-500",children:"อัพโหลดรูปภาพ JPG, PNG ขนาดไม่เกิน 2MB"}),d&&e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"กำลังอัปโหลดรูปภาพ..."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ชื่อ-นามสกุล"}),e.jsx("input",{type:"text",value:r.full_name||"",onChange:a=>i({...r,full_name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"กรอกชื่อ-นามสกุล"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"อีเมล"}),e.jsx("input",{type:"email",value:r.email||"",readOnly:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500 cursor-not-allowed",placeholder:"กรอกอีเมล"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"อีเมลไม่สามารถแก้ไขได้ เนื่องจากใช้สำหรับเข้าสู่ระบบ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"เบอร์โทรศัพท์"}),e.jsx("input",{type:"tel",value:r.phone||"",onChange:a=>i({...r,phone:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"กรอกเบอร์โทรศัพท์"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"อายุ"}),e.jsx("input",{type:"number",value:r.age||"",onChange:a=>i({...r,age:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"กรอกอายุ",min:"1",max:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ระดับชั้น"}),e.jsxs("select",{value:r.grade_level||"",onChange:a=>i({...r,grade_level:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"เลือกระดับชั้น"}),e.jsx("option",{value:"ม.1",children:"มัธยมศึกษาปีที่ 1"}),e.jsx("option",{value:"ม.2",children:"มัธยมศึกษาปีที่ 2"}),e.jsx("option",{value:"ม.3",children:"มัธยมศึกษาปีที่ 3"}),e.jsx("option",{value:"ม.4",children:"มัธยมศึกษาปีที่ 4"}),e.jsx("option",{value:"ม.5",children:"มัธยมศึกษาปีที่ 5"}),e.jsx("option",{value:"ม.6",children:"มัธยมศึกษาปีที่ 6"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"โรงเรียน"}),e.jsx("input",{type:"text",value:r.school_name||"",onChange:a=>i({...r,school_name:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"กรอกชื่อโรงเรียน"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"เกี่ยวกับฉัน"}),e.jsx("textarea",{value:r.bio||"",onChange:a=>i({...r,bio:a.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"เขียนข้อมูลเกี่ยวกับตัวคุณ..."})]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx(f,{onClick:b,disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-4 h-4 mr-2 animate-spin"}),"กำลังบันทึก..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"บันทึกข้อมูล"]})})})]})}),_=()=>N();return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"การตั้งค่า"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"จัดการข้อมูลส่วนตัวของคุณ (เก็บในฐานข้อมูล)"})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsx(f,{variant:"outline",onClick:y,disabled:m,className:"text-red-600 border-red-300 hover:bg-red-50 hover:border-red-400",children:m?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-4 h-4 mr-2 animate-spin"}),"กำลังล้าง..."]}):"ล้างข้อมูลโปรไฟล์"})})]}),e.jsx("div",{className:"max-w-4xl mx-auto",children:_()})]})})};export{z as default};
