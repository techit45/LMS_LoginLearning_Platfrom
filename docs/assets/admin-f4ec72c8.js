import{r as g,j as e,R as ne,S as Ke,C as se,X as le,A as W,F as K,L as Xe,P as de,T as pe,a as me,G as Ze,b as Re,c as ue,I as Y,d as Q,e as fe,u as Ce,U as Z,B as ie,f as Ye,g as Pe,h as re,i as be,D as Qe,H as he,k as et,l as ve,m as ce,n as te,E as ae,o as tt,p as st,q as we,s as Se,W as rt,t as qe,v as ze,w as Ne,x as je,y as Ee,z as Te,J as xe,K as ye,M as oe,N as at,O as lt,Q as ot,V as _e,Y as Fe,Z as nt,_ as it,$ as ke,a0 as Me,a1 as ct,a2 as dt,a3 as mt,a4 as ut,a5 as xt,a6 as ht,a7 as gt,a8 as pt,a9 as ft,aa as Oe,ab as bt,ac as jt,ad as vt,ae as wt}from"./vendor-558e3516.js";import{A as ge,m as R}from"./ui-675b1de5.js";import{t as Nt,c as yt,a as _t,b as Ct}from"./vendor-misc-0d9f0c57.js";function Ge(...s){return Nt(yt(s))}const St=1;let Ue=0;function Et(){return Ue=(Ue+1)%Number.MAX_VALUE,Ue.toString()}const X={state:{toasts:[]},listeners:[],getState:()=>X.state,setState:s=>{typeof s=="function"?X.state=s(X.state):X.state={...X.state,...s},X.listeners.forEach(t=>t(X.state))},subscribe:s=>(X.listeners.push(s),()=>{X.listeners=X.listeners.filter(t=>t!==s)})},kt=({...s})=>{const t=Et(),r=l=>X.setState(o=>({...o,toasts:o.toasts.map(i=>i.id===t?{...i,...l}:i)})),a=()=>X.setState(l=>({...l,toasts:l.toasts.filter(o=>o.id!==t)}));return X.setState(l=>({...l,toasts:[{...s,id:t,dismiss:a},...l.toasts].slice(0,St)})),{id:t,dismiss:a,update:r}};function ee(){const[s,t]=g.useState(X.getState());return g.useEffect(()=>X.subscribe(a=>{t(a)}),[]),g.useEffect(()=>{const r=[];return s.toasts.forEach(a=>{if(a.duration===1/0)return;const l=setTimeout(()=>{a.dismiss()},a.duration||5e3);r.push(l)}),()=>{r.forEach(a=>clearTimeout(a))}},[s.toasts]),{toast:kt,toasts:s.toasts}}const Be=g.createContext(),Ut=(s,t)=>{switch(t.type){case"ADD_TOAST":return[...s,t.toast];case"REMOVE_TOAST":return s.filter(r=>r.id!==t.id);case"CLEAR_TOASTS":return[];default:return s}},Ts=({children:s})=>{const[t,r]=g.useReducer(Ut,[]),a=g.useCallback(({title:i,description:w,variant:u="default",duration:x=5e3})=>{const _=Date.now()+Math.random();r({type:"ADD_TOAST",toast:{id:_,title:i,description:w,variant:u,duration:x}}),setTimeout(()=>{r({type:"REMOVE_TOAST",id:_})},x)},[]),l=g.useCallback(i=>{r({type:"REMOVE_TOAST",id:i})},[]),o=g.useCallback(()=>{r({type:"CLEAR_TOASTS"})},[]);return e.jsx(Be.Provider,{value:{toast:a,removeToast:l,clearToasts:o,toasts:t},children:s})},Ae=()=>{const s=g.useContext(Be);if(!s)throw new Error("useToast must be used within a ToastProvider");return s},Pt="https://vuitwzisazvikrhtfthh.supabase.co",Tt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ1aXR3emlzYXp2aWtyaHRmdGhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzOTU4ODIsImV4cCI6MjA2Njk3MTg4Mn0.VXCqythCUualJ7S9jVvnQUYe9BKnfMvbihtZT5c3qyE";console.log("Supabase URL:","Set");console.log("Supabase Key:","Set");const d=_t(Pt,Tt);d||console.error("Supabase client not initialized. Check environment variables.");const At="login-learning.com",We=g.createContext(),H={SUPER_ADMIN:"super_admin",BRANCH_MANAGER:"branch_manager",INSTRUCTOR:"instructor",STUDENT:"student",PARENT:"parent",GUEST:"guest"},Le=s=>s?s.toLowerCase().endsWith(`@${At}`):!1,As=({children:s})=>{const[t,r]=g.useState(null),[a,l]=g.useState(!0),[o,i]=g.useState(!1),[w,u]=g.useState(H.GUEST),{toast:x}=Ae();g.useEffect(()=>{(async()=>{try{if(!d){console.warn("Supabase client is not initialized. This might be because Supabase URL or Anon Key are missing or incorrect."),x&&x({title:"⚠️ Supabase ยังไม่ได้เริ่มการทำงาน",description:"กรุณาตรวจสอบการตั้งค่า Supabase URL และ Anon Key",variant:"destructive",duration:1e4}),l(!1);return}(()=>{try{const S=localStorage.getItem("sb-vuitwzisazvikrhtfthh-auth-token");if(S){const N=JSON.parse(S);(!N.refresh_token||!N.access_token)&&(localStorage.removeItem("sb-vuitwzisazvikrhtfthh-auth-token"),console.log("Cleared invalid stored auth data"))}}catch{localStorage.removeItem("sb-vuitwzisazvikrhtfthh-auth-token"),console.log("Cleared corrupted stored auth data")}})(),(async()=>{try{const{data:{session:S},error:N}=await d.auth.getSession();if(N){if(console.error("Error getting session:",N),N.message.includes("Invalid Refresh Token")||N.message.includes("Refresh Token Not Found")){await d.auth.signOut(),localStorage.removeItem("sb-vuitwzisazvikrhtfthh-auth-token"),console.log("Cleared invalid session");return}x&&x({title:"ข้อผิดพลาดในการโหลดเซสชัน",description:N.message,variant:"destructive"})}const C=(S==null?void 0:S.user)??null;if(r(C),C)if(Le(C.email))i(!0),u(H.SUPER_ADMIN);else try{const{data:n,error:U}=await d.from("user_profiles").select("role").eq("user_id",C.id).maybeSingle();U&&console.log("Error fetching user profile:",U);const q=(n==null?void 0:n.role)||"student",L=q==="admin"?H.SUPER_ADMIN:q==="instructor"?H.INSTRUCTOR:H.STUDENT;i(q==="admin"||q==="instructor"),u(L)}catch{console.log("Could not fetch user role from database, using default"),i(!1),u(H.STUDENT)}else i(!1),u(H.GUEST)}catch(S){console.error("Exception in getSession:",S),x({title:"เกิดข้อผิดพลาดร้ายแรงในการโหลดเซสชัน",description:S.message,variant:"destructive"})}finally{l(!1)}})();const{data:m}=d.auth.onAuthStateChange(async(S,N)=>{console.log("Auth state change:",S,N);const C=(N==null?void 0:N.user)??null;if(r(C),C)if(Le(C.email))i(!0),u(H.SUPER_ADMIN);else try{const{data:n,error:U}=await d.from("user_profiles").select("role").eq("user_id",C.id).maybeSingle();U&&console.log("Error fetching user profile:",U);const q=(n==null?void 0:n.role)||"student",L=q==="admin"?H.SUPER_ADMIN:q==="instructor"?H.INSTRUCTOR:H.STUDENT;i(q==="admin"||q==="instructor"),u(L)}catch{console.log("Could not fetch user role from database, using default"),i(!1),u(H.STUDENT)}else i(!1),u(H.GUEST);S==="SIGNED_IN"&&C?x({title:`เข้าสู่ระบบสำเร็จในฐานะ ${w}!`}):S==="PASSWORD_RECOVERY"?x({title:"การกู้คืนรหัสผ่าน",description:"คำแนะนำในการกู้คืนรหัสผ่านถูกส่งไปยังอีเมลของคุณแล้ว"}):S==="USER_UPDATED"&&x({title:"ข้อมูลผู้ใช้อัปเดตแล้ว"}),l(!1)});return()=>{m==null||m.subscription.unsubscribe()}}catch(b){console.error("Error initializing auth:",b),l(!1)}})()},[x]);const T={user:t,isAdmin:o,userRole:w,ROLES:H,hasRole:j=>t?w===H.SUPER_ADMIN?!0:w===j:!1,signInWithPassword:async(j,b)=>{if(!d)return x({title:"Supabase ยังไม่ได้เชื่อมต่อ",description:"กรุณาเชื่อมต่อ Supabase ก่อนใช้งาน",variant:"destructive"}),{error:{message:"Supabase client not initialized"}};l(!0),console.log("Attempting to sign in with email:",j);const{data:h,error:m}=await d.auth.signInWithPassword({email:j,password:b});return console.log("Sign in result:",{data:h,error:m}),m&&(console.error("Sign in error:",m),m.message.includes("Email not confirmed")?x({title:"อีเมลยังไม่ได้รับการยืนยัน",description:"กรุณาตรวจสอบอีเมลและคลิกลิงก์ยืนยันก่อนเข้าสู่ระบบ",variant:"destructive"}):m.message.includes("Invalid login credentials")&&x({title:"ข้อมูลไม่ถูกต้อง",description:"อีเมลหรือรหัสผ่านไม่ถูกต้อง",variant:"destructive"})),l(!1),{data:h,error:m}},signUpWithPassword:async(j,b,h)=>{if(!d)return x({title:"Supabase ยังไม่ได้เชื่อมต่อ",description:"กรุณาเชื่อมต่อ Supabase ก่อนใช้งาน",variant:"destructive"}),{error:{message:"Supabase client not initialized"}};l(!0);const{data:m,error:S}=await d.auth.signUp({email:j,password:b,options:{data:{full_name:h,role:H.STUDENT}}});return l(!1),{data:m,error:S}},signInWithGoogle:async()=>{if(!d)return x({title:"Supabase ยังไม่ได้เชื่อมต่อ",description:"กรุณาเชื่อมต่อ Supabase ก่อนใช้งาน",variant:"destructive"}),{error:{message:"Supabase client not initialized"}};l(!0);const{data:j,error:b}=await d.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}});return l(!1),{data:j,error:b}},signOut:async()=>{if(!d)return x({title:"Supabase ยังไม่ได้เชื่อมต่อ",description:"กรุณาเชื่อมต่อ Supabase ก่อนใช้งาน",variant:"destructive"}),{error:{message:"Supabase client not initialized"}};l(!0);const{error:j}=await d.auth.signOut();return l(!1),j||(r(null),i(!1),u(H.GUEST)),{error:j}},loading:a,isSupabaseConnected:!!d};return e.jsx(We.Provider,{value:T,children:s})},Ve=()=>{const s=g.useContext(We);if(!s)throw new Error("useAuth must be used within an AuthProvider");return s},Dt=Ct("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),E=ne.forwardRef(({className:s,variant:t,size:r,asChild:a=!1,...l},o)=>{const i=a?Ke:"button";return e.jsx(i,{className:Ge(Dt({variant:t,size:r,className:s})),ref:o,...l})});E.displayName="Button";class $t{constructor(t=5*60*1e3){this.cache=new Map,this.defaultTTL=t}set(t,r,a=this.defaultTTL){const l=Date.now()+a;this.cache.set(t,{value:r,expiresAt:l})}get(t){const r=this.cache.get(t);return r?Date.now()>r.expiresAt?(this.cache.delete(t),null):r.value:null}has(t){return this.get(t)!==null}clear(){this.cache.clear()}delete(t){this.cache.delete(t)}}const Ie=new $t,Je=(s,...t)=>`${s}:${t.join(":")}`,He=async(s,t,r)=>{const a=Ie.get(s);if(a)return a;try{const l=await t();return l&&!l.error&&Ie.set(s,l,r),l}catch(l){return{data:null,error:l}}},Ds=async()=>{const s=Je("courses","all");return He(s,async()=>{try{const{data:t,error:r}=await d.from("courses").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(r)throw r;return{data:t.map(l=>({...l,enrollment_count:0})),error:null}}catch(t){return console.error("Error fetching courses:",t),{data:null,error:t}}},2*60*1e3)},qt=async s=>{try{console.log("getCourseById: Fetching course with ID:",s);const{data:t,error:r}=await d.from("courses").select(`
        *,
        course_content(*)
      `).eq("id",s).eq("is_active",!0).maybeSingle();if(console.log("getCourseById: Database result:",{data:t,error:r}),r)throw console.error("getCourseById: Database error:",r),r;if(!t)return console.log("getCourseById: Course not found or inactive"),{data:null,error:{message:"ไม่พบคอร์สที่ระบุหรือคอร์สไม่เปิดใช้งาน",code:"COURSE_NOT_FOUND"}};let a=0;try{const{count:o}=await d.from("enrollments").select("*",{count:"exact",head:!0}).eq("course_id",s);a=o||0,console.log("getCourseById: Enrollment count:",a)}catch(o){console.warn("Could not fetch enrollment count:",o)}const l={data:{...t,enrollment_count:a,content:t.course_content||[]},error:null};return console.log("getCourseById: Final result:",l),l}catch(t){return console.error("getCourseById: Error fetching course:",t),{data:null,error:t}}},zt=async s=>{try{const{data:t,error:r}=await d.from("courses").select(`
        *,
        course_content(*)
      `).eq("id",s).maybeSingle();if(r)throw r;if(!t)return{data:null,error:{message:"ไม่พบคอร์สที่ระบุ",code:"COURSE_NOT_FOUND"}};let a=0;try{const{count:l}=await d.from("enrollments").select("*",{count:"exact",head:!0}).eq("course_id",s);a=l||0}catch(l){console.warn("Could not fetch enrollment count:",l)}return{data:{...t,enrollment_count:a,content:t.course_content||[]},error:null}}catch(t){return console.error("Error fetching course for admin:",t),{data:null,error:t}}},Lt=async s=>{try{const{data:{user:t},error:r}=await d.auth.getUser();if(r||!t)throw new Error("User not authenticated");const{data:a,error:l}=await d.from("user_profiles").select("user_id").eq("user_id",t.id).maybeSingle();if(l)throw console.error("Error checking user profile:",l),new Error("ไม่สามารถตรวจสอบข้อมูลผู้ใช้ได้");if(!a)throw new Error("ไม่พบข้อมูลผู้ใช้ กรุณาติดต่อผู้ดูแลระบบ");const{data:o,error:i}=await d.from("courses").insert([{...s,instructor_id:t.id}]).select().single();if(i)throw i;return{data:o,error:null}}catch(t){return console.error("Error creating course:",t),{data:null,error:t}}},It=async(s,t)=>{try{const{data:r,error:a}=await d.from("courses").update(t).eq("id",s).select().single();if(a)throw a;return{data:r,error:null}}catch(r){return console.error("Error updating course:",r),{data:null,error:r}}},Rt=async(s,t)=>{try{const{error:r}=await d.from("courses").update({is_active:t}).eq("id",s);if(r)throw r;return{error:null}}catch(r){return console.error("Error toggling course status:",r),{error:r}}},Ft=async()=>{try{if(console.log("Fetching admin courses..."),!d)throw new Error("Supabase client not initialized");const{data:s,error:t}=await d.from("courses").select("*").order("created_at",{ascending:!1});if(t)throw console.error("Supabase error:",t),new Error(`Database error: ${t.message}`);return console.log("Admin courses fetched successfully:",(s==null?void 0:s.length)||0,"courses"),{data:s||[],error:null}}catch(s){return console.error("Error fetching admin courses:",s),{data:null,error:{message:s.message||"Unknown error occurred",details:s}}}},$s=async()=>{const s=Je("courses","featured");return He(s,async()=>{try{console.log("Fetching featured courses...");const t=new Promise((i,w)=>{setTimeout(()=>w(new Error("Request timeout")),1e4)}),r=d.from("courses").select("*").eq("is_active",!0).eq("is_featured",!0).order("created_at",{ascending:!1}).limit(4),{data:a,error:l}=await Promise.race([r,t]);if(console.log("Featured courses query result:",{data:a,error:l}),l)throw l;if(!a||a.length===0){console.log("No featured courses found, getting first 4 active courses");const i=d.from("courses").select("*").eq("is_active",!0).order("created_at",{ascending:!1}).limit(4),{data:w,error:u}=await Promise.race([i,t]);if(console.log("Fallback courses query result:",{fallbackData:w,fallbackError:u}),u)throw u;return{data:(w||[]).map(_=>({..._,enrollment_count:0})),error:null}}return{data:a.map(i=>({...i,enrollment_count:0})),error:null}}catch(t){return console.error("Error fetching featured courses:",t),{data:[],error:null}}},3*60*1e3)},Mt=async(s,t)=>{try{const{error:r}=await d.from("courses").update({is_featured:t}).eq("id",s);if(r)throw r;return{error:null}}catch(r){return console.error("Error toggling course featured status:",r),{error:r}}},Ot=async()=>{try{const{count:s,error:t}=await d.from("courses").select("*",{count:"exact",head:!0}).eq("is_active",!0);if(t)throw t;const{count:r,error:a}=await d.from("enrollments").select("*",{count:"exact",head:!0});if(a)throw a;const{count:l,error:o}=await d.from("enrollments").select("*",{count:"exact",head:!0}).eq("is_active",!0);if(o)throw o;const{count:i,error:w}=await d.from("enrollments").select("*",{count:"exact",head:!0}).not("completed_at","is",null);if(w)throw w;return{data:{totalCourses:s||0,totalEnrollments:r||0,activeEnrollments:l||0,completedEnrollments:i||0,completionRate:r>0?(i/r*100).toFixed(1):0},error:null}}catch(s){return console.error("Error fetching course stats:",s),{data:null,error:s}}},O=ne.forwardRef(({className:s,type:t,...r},a)=>e.jsx("input",{type:t,className:Ge("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...r}));O.displayName="Input";const Gt=async s=>{try{const{data:t,error:r}=await d.from("attachments").select("*").eq("entity_type","course_content").eq("entity_id",s).order("upload_order",{ascending:!0});if(r)throw r;return{data:t||[],error:null}}catch(t){return console.error("Error fetching content attachments:",t),{data:[],error:t}}},Bt=async(s,t,r=1)=>{try{console.log("Starting file upload:",{fileName:s.name,contentId:t,fileSize:s.size});const{data:{user:a},error:l}=await d.auth.getUser();if(l)throw console.error("User authentication error:",l),new Error(`Authentication error: ${l.message}`);if(!a)throw new Error("User not authenticated - please login first");if(console.log("User authenticated:",a.id),!s)throw new Error("No file provided");if(!t)throw new Error("Content ID is required");const o=Date.now(),i=s.name.split(".").pop(),w=s.name.replace(/[^a-zA-Z0-9.-]/g,"_"),u=`${o}_${w}`,x=`attachments/${t}/${u}`;console.log("Generated file path:",x),console.log("Checking storage bucket access...");let _=!1;try{const{data:m,error:S}=await d.storage.listBuckets();if(S)console.warn("Cannot list buckets, trying direct access:",S.message);else{const N=m.find(C=>C.name==="course-files");N&&(console.log("Storage bucket found in list:",N.name),_=!0)}if(!_){console.log("Testing direct bucket access...");const{error:N}=await d.storage.from("course-files").list("",{limit:1});if(N)throw console.error("Direct bucket access failed:",N),new Error(`Storage bucket "course-files" is not accessible: ${N.message}. Please check bucket exists and permissions are correct.`);console.log("Direct bucket access successful"),_=!0}}catch(m){throw console.error("Storage bucket check failed:",m),new Error(`Storage setup error: ${m.message}`)}if(!_)throw new Error('Storage bucket "course-files" not found or not accessible. Please setup storage first.');console.log("Uploading file to storage...");const{data:y,error:p}=await d.storage.from("course-files").upload(x,s,{cacheControl:"3600",upsert:!1});if(p)throw console.error("Storage upload error:",p),new Error(`File upload failed: ${p.message}`);console.log("File uploaded successfully:",y);const{data:{publicUrl:k}}=d.storage.from("course-files").getPublicUrl(x);console.log("Generated public URL:",k);const{error:P}=await d.from("attachments").select("count").limit(1);if(P&&P.code==="42P01")throw new Error('Database table "attachments" not found. Please run the database schema setup.');console.log("Saving attachment record to database...");let T=1;if(typeof r=="number"&&r>0&&r<=2147483647)T=Math.floor(r);else if(typeof r=="string"){const m=parseInt(r);!isNaN(m)&&m>0&&m<=2147483647&&(T=m)}console.log("Original uploadOrder:",r,"Valid uploadOrder:",T);const j={entity_type:"course_content",entity_id:t,filename:s.name,original_filename:s.name,file_url:k,file_path:x,file_size:s.size,file_extension:(i==null?void 0:i.toLowerCase())||"unknown",mime_type:s.type||"application/octet-stream",upload_order:T,is_public:!1,uploaded_by:a.id};console.log("Attachment record:",j);const{data:b,error:h}=await d.from("attachments").insert([j]).select().single();if(h){console.error("Database insert error:",h);try{await d.storage.from("course-files").remove([x]),console.log("Cleaned up uploaded file after database error")}catch(m){console.error("Failed to cleanup file:",m)}throw new Error(`Database error: ${h.message}`)}return console.log("Attachment record saved:",b),{data:{...b,url:k,file_path:x},error:null}}catch(a){return console.error("Error uploading attachment:",a),{data:null,error:{message:a.message,details:a}}}},De=async s=>{var t;try{console.log("Starting course image upload:",{fileName:s.name,fileSize:s.size});const{data:{user:r},error:a}=await d.auth.getUser();if(a||!r)throw new Error("User not authenticated");if(!s)throw new Error("No image file provided");if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(s.type))throw new Error("ไฟล์ต้องเป็นรูปภาพ (JPG, PNG, WebP เท่านั้น)");const o=5*1024*1024;if(s.size>o)throw new Error("ขนาดไฟล์ต้องไม่เกิน 5MB");const i=(t=s.name.split(".").pop())==null?void 0:t.toLowerCase(),w=`course-cover-${Date.now()}-${Math.random().toString(36).substring(2)}.${i}`,u=`course-covers/${w}`;console.log("Uploading image to path:",u);const{data:x,error:_}=await d.storage.from("course-files").upload(u,s,{cacheControl:"3600",upsert:!1});if(_)throw console.error("Storage upload error:",_),new Error(`ไม่สามารถอัปโหลดรูปภาพได้: ${_.message}`);console.log("Image upload successful:",x);const{data:y}=d.storage.from("course-files").getPublicUrl(u);if(!(y!=null&&y.publicUrl))throw new Error("ไม่สามารถสร้าง URL สำหรับรูปภาพได้");return console.log("Public URL generated:",y.publicUrl),{data:{filePath:u,publicUrl:y.publicUrl,fileName:w},error:null}}catch(r){return console.error("Error uploading course image:",r),{data:null,error:r}}},qs=async s=>{var t;try{console.log("Starting profile image upload:",{fileName:s.name,fileSize:s.size});const{data:{user:r},error:a}=await d.auth.getUser();if(a||!r)throw new Error("User not authenticated");if(!s)throw new Error("No image file provided");if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(s.type))throw new Error("ไฟล์ต้องเป็นรูปภาพ (JPG, PNG, WebP เท่านั้น)");const o=2*1024*1024;if(s.size>o)throw new Error("ขนาดไฟล์ต้องไม่เกิน 2MB");const i=(t=s.name.split(".").pop())==null?void 0:t.toLowerCase(),w=`profile-${r.id}-${Date.now()}.${i}`,u=`profile-images/${w}`;console.log("Uploading profile image to path:",u);try{const{data:p}=await d.storage.from("course-files").list("profile-images",{search:`profile-${r.id}-`});if(p&&p.length>0){const k=p.map(P=>`profile-images/${P.name}`);await d.storage.from("course-files").remove(k),console.log("Removed old profile images:",k)}}catch(p){console.warn("Could not cleanup old profile images:",p)}const{data:x,error:_}=await d.storage.from("course-files").upload(u,s,{cacheControl:"3600",upsert:!1});if(_)throw console.error("Storage upload error:",_),new Error(`ไม่สามารถอัปโหลดรูปโปรไฟล์ได้: ${_.message}`);console.log("Profile image upload successful:",x);const{data:y}=d.storage.from("course-files").getPublicUrl(u);if(!(y!=null&&y.publicUrl))throw new Error("ไม่สามารถสร้าง URL สำหรับรูปโปรไฟล์ได้");return console.log("Profile image URL generated:",y.publicUrl),{data:{filePath:u,publicUrl:y.publicUrl,fileName:w},error:null}}catch(r){return console.error("Error uploading profile image:",r),{data:null,error:r}}},Wt=async s=>{try{console.log("Using course_id approach for assignment lookup to avoid schema issues");const{data:t,error:r}=await d.from("course_content").select("course_id, title").eq("id",s).single();if(r||!t)return{data:null,error:null};const a=await d.from("assignments").select("*").eq("course_id",t.course_id).eq("is_active",!0).order("id",{ascending:!1}).limit(1);if(a.error)return console.error("Error fetching assignments by course_id:",a.error),{data:null,error:null};const l=a.data||[];return{data:l.length>0?l[0]:null,error:null}}catch(t){return console.error("Error fetching assignment:",t),{data:null,error:null}}},Vt=async s=>{try{const{data:{user:t},error:r}=await d.auth.getUser();if(r||!t)return{data:[],error:null};const{data:a,error:l}=await d.from("assignment_submissions").select("*").eq("user_id",t.id).eq("assignment_id",s).order("id",{ascending:!1});if(l)throw l;return{data:a||[],error:null}}catch(t){return console.error("Error fetching user submissions:",t),{data:[],error:t}}},zs=async(s,t)=>{try{const{data:{user:r},error:a}=await d.auth.getUser();if(a||!r)throw new Error("User not authenticated");const{data:l,error:o}=await d.from("assignments").select("*").eq("id",s).single();if(o)throw o;const{data:i,error:w}=await Vt(s);if(w)throw w;const u=l.due_date?new Date>new Date(l.due_date):!1,{data:x,error:_}=await d.from("assignment_submissions").insert([{user_id:r.id,assignment_id:s,submission_text:t.text||""}]).select().single();if(_)throw _;return{data:x,error:null}}catch(r){return console.error("Error creating submission:",r),{data:null,error:r}}},Ls=async(s,t)=>{try{const{data:{user:r},error:a}=await d.auth.getUser();if(a||!r)throw new Error("User not authenticated");const{data:l,error:o}=await d.from("assignment_submissions").update({submission_text:t.text||""}).eq("id",s).eq("user_id",r.id).select().single();if(o)throw o;return{data:l,error:null}}catch(r){return console.error("Error updating submission:",r),{data:null,error:r}}},Is=async s=>{try{const{data:{user:t},error:r}=await d.auth.getUser();if(r||!t)throw new Error("User not authenticated");const{data:a,error:l}=await d.from("assignment_submissions").update({submitted_at:new Date().toISOString()}).eq("id",s).eq("user_id",t.id).select().single();if(l)throw l;return{data:a,error:null}}catch(t){return console.error("Error submitting final submission:",t),{data:null,error:t}}},Rs=async(s,t,r)=>{try{const{data:{user:a},error:l}=await d.auth.getUser();if(l||!a)throw new Error("User not authenticated");if((await Wt(s)).data)throw new Error("งานมอบหมายสำหรับเนื้อหานี้มีอยู่แล้ว");const i={title:r.title,description:r.description||"",instructions:r.instructions||"",due_date:r.due_date,max_score:r.max_score||100,is_active:!0};try{i.content_id=s;const{data:w,error:u}=await d.from("assignments").insert([i]).select().single();if(u)throw u;return{data:w,error:null}}catch{console.log("content_id column not found, using course_id fallback"),delete i.content_id,i.course_id=t;const{data:u,error:x}=await d.from("assignments").insert([i]).select().single();if(x)throw x;return{data:u,error:null}}}catch(a){return console.error("Error creating assignment for content:",a),{data:null,error:a}}},Jt=async s=>{try{const{data:t,error:r}=await d.from("assignments").select("*").eq("id",s).single();if(r)throw r;return{data:t,error:null}}catch(t){return console.error("Error fetching assignment:",t),{data:null,error:t}}},Ht=async s=>{try{const{data:t,error:r}=await d.from("assignment_submissions").select(`
        *,
        user_profiles!assignment_submissions_user_id_fkey(full_name, email, avatar_url)
      `).eq("assignment_id",s).order("submitted_at",{ascending:!1});if(r)throw r;return{data:t,error:null}}catch(t){return console.error("Error fetching assignment submissions:",t),{data:null,error:t}}},Kt=async(s,t)=>{try{const{data:{user:r},error:a}=await d.auth.getUser();if(a||!r)throw new Error("User not authenticated");const{data:l,error:o}=await d.from("assignment_submissions").update({score:t.score,feedback:t.feedback,graded_at:t.graded_at||new Date().toISOString(),graded_by:t.graded_by||r.id,grading_rubric_scores:t.grading_rubric_scores||null}).eq("id",s).select().single();if(o)throw o;return{data:l,error:null}}catch(r){return console.error("Error updating submission grade:",r),{data:null,error:r}}},Xt=async s=>{try{const{data:t,error:r}=await d.from("course_content").select("*").eq("course_id",s).order("order_index",{ascending:!0});if(r)throw r;return{data:t||[],error:null}}catch(t){return console.error("Error fetching content with progress:",t),{data:[],error:t}}},Zt=async(s=null)=>{try{let t=s;if(!t){const{data:{user:l},error:o}=await d.auth.getUser();if(o||!l)throw new Error("User not authenticated");t=l.id}const{data:r,error:a}=await d.from("user_profiles").select("*").eq("user_id",t).single();if(a&&a.code!=="PGRST116")throw a;return r?{data:r,error:null}:{data:{user_id:t,full_name:"",age:null,school_name:"",grade_level:"",phone:"",interested_fields:[],bio:"",avatar_url:""},error:null}}catch(t){return console.error("Error fetching user profile:",t),{data:null,error:t}}},Yt=async s=>{try{const{data:{user:t},error:r}=await d.auth.getUser();if(r||!t)throw new Error("User not authenticated");const{data:a,error:l}=await d.from("user_profiles").update(s).eq("user_id",t.id).select().single();if(l)throw l;return{data:a,error:null}}catch(t){return console.error("Error updating user profile:",t),{data:null,error:t}}},Qt=async()=>{try{const{data:s,error:t}=await d.from("user_profiles").select(`
        *,
        enrollments(count),
        achievements(count)
      `).order("created_at",{ascending:!1});return t?(console.error("Error fetching user profiles:",t),{data:[],error:t}):{data:s.map(a=>{var l,o,i,w;return{...a,enrollment_count:((o=(l=a.enrollments)==null?void 0:l[0])==null?void 0:o.count)||0,achievement_count:((w=(i=a.achievements)==null?void 0:i[0])==null?void 0:w.count)||0}}),error:null}}catch(s){return console.error("Error fetching users for admin:",s),{data:[],error:s}}},es=async(s,t)=>{try{const{data:r,error:a}=await d.from("user_profiles").update({role:t}).eq("user_id",s).select().single();if(a)throw a;return{data:r,error:null}}catch(r){return console.error("Error updating user role:",r),{data:null,error:r}}},Fs=async()=>{try{const{data:{user:s}}=await d.auth.getUser();if(!s)throw new Error("User not authenticated");const{data:t,error:r}=await Zt(s.id);if(r)throw r;return{data:t,error:null}}catch(s){return console.error("Error getting profile settings:",s),{data:null,error:s}}},Ms=async s=>{try{const{data:{user:t}}=await d.auth.getUser();if(!t)throw new Error("User not authenticated");const{data:r,error:a}=await Yt(s);if(a)throw a;return{data:r,error:null}}catch(t){return console.error("Error saving profile settings:",t),{data:null,error:t}}},Os=async()=>{try{const{data:{user:s}}=await d.auth.getUser();if(!s)throw new Error("User not authenticated");const{error:t}=await d.from("user_settings").delete().eq("user_id",s.id);if(t)throw t;return{data:!0,error:null}}catch(s){return console.error("Error deleting user settings:",s),{data:null,error:s}}},Gs=async()=>{try{const{data:s,error:t}=await d.from("projects").select(`
        id,
        title,
        description,
        short_description,
        category,
        difficulty_level,
        is_featured,
        technologies,
        project_url,
        github_url,
        cover_image_url,
        image_url,
        featured_image_url,
        technology,
        demo_url,
        thumbnail_url,
        creator_id,
        created_at,
        updated_at,
        is_approved
      `).eq("is_approved",!0).order("created_at",{ascending:!1});if(t)throw t;return{data:s||[],error:null}}catch(s){return console.error("Error fetching projects:",s),{data:null,error:s}}},Bs=async s=>{try{const{data:t,error:r}=await d.from("projects").select("*").eq("id",s).eq("is_approved",!0).single();if(r)throw r;return{data:t,error:null}}catch(t){return console.error("Error fetching project:",t),{data:null,error:t}}},Ws=async s=>{try{const{data:t,error:r}=await d.from("projects").select("*").eq("id",s).single();if(r)throw r;return{data:t,error:null}}catch(t){return console.error("Error fetching project for edit:",t),{data:null,error:t}}},Vs=async()=>{try{const{data:s,error:t}=await d.from("projects").select(`
        id,
        title,
        description,
        short_description,
        category,
        difficulty_level,
        is_featured,
        technologies,
        project_url,
        github_url,
        cover_image_url,
        image_url,
        featured_image_url,
        technology,
        demo_url,
        thumbnail_url,
        creator_id,
        created_at,
        updated_at,
        is_approved
      `).eq("is_featured",!0).eq("is_approved",!0).order("created_at",{ascending:!1}).limit(6);if(t)throw t;return{data:s||[],error:null}}catch(s){return console.error("Error fetching featured projects:",s),{data:null,error:s}}},ts=async s=>{try{const{data:{user:t},error:r}=await d.auth.getUser();if(r||!t)throw new Error("User not authenticated");const{data:a,error:l}=await d.from("projects").insert([{...s,creator_id:t.id}]).select().single();if(l)throw l;return{data:a,error:null}}catch(t){return console.error("Error creating project:",t),{data:null,error:t}}},Js=async(s,t)=>{try{const{data:r,error:a}=await d.from("projects").update(t).eq("id",s).select().single();if(a)throw a;return{data:r,error:null}}catch(r){return console.error("Error updating project:",r),{data:null,error:r}}},ss=async s=>{try{const{error:t}=await d.from("projects").update({is_approved:!1}).eq("id",s);if(t)throw t;return{error:null}}catch(t){return console.error("Error deleting project:",t),{error:t}}},rs=async(s,t)=>{try{const{error:r}=await d.from("projects").update({is_approved:t}).eq("id",s);if(r)throw r;return{error:null}}catch(r){return console.error("Error toggling project approval:",r),{error:r}}},as=async(s,t)=>{try{const{error:r}=await d.from("projects").update({is_featured:t}).eq("id",s);if(r)throw r;return{error:null}}catch(r){return console.error("Error toggling project featured status:",r),{error:r}}},ls=async()=>{try{const{data:s,error:t}=await d.from("projects").select("*").order("created_at",{ascending:!1});if(t)throw t;return{data:s||[],error:null}}catch(s){return console.error("Error fetching admin projects:",s),{data:null,error:s}}},os=async()=>{try{const{count:s,error:t}=await d.from("projects").select("*",{count:"exact",head:!0}).eq("is_approved",!0);if(t)throw t;const{count:r,error:a}=await d.from("projects").select("*",{count:"exact",head:!0}).eq("is_featured",!0).eq("is_approved",!0);if(a)throw a;const{data:l,error:o}=await d.from("projects").select("category").eq("is_approved",!0);if(o)throw o;const i=new Set((l==null?void 0:l.map(w=>w.category))||[]);return{data:{totalProjects:s||0,featuredProjects:r||0,totalCategories:i.size,categories:Array.from(i)},error:null}}catch(s){return console.error("Error fetching project stats:",s),{data:null,error:s}}},ns=({isOpen:s,onClose:t,onSuccess:r})=>{const{toast:a}=Ae(),[l,o]=g.useState(!1),[i,w]=g.useState({title:"",description:"",short_description:"",category:"",difficulty_level:"beginner",duration_hours:"",is_featured:!1,technologies:[],project_url:"",github_url:"",video_url:"",cover_image_url:"",content_html:"",tags:[],status:"published"}),[u,x]=g.useState({}),[_,y]=g.useState(null),[p,k]=g.useState(!1),[P,T]=g.useState(null),[j,b]=g.useState(""),[h,m]=g.useState(""),S=f=>{const{name:A,value:G,type:B,checked:v}=f.target;w(D=>({...D,[A]:B==="checkbox"?v:G})),u[A]&&x(D=>({...D,[A]:""}))},N=()=>{j.trim()&&!i.technologies.includes(j.trim())&&(w(f=>({...f,technologies:[...f.technologies,j.trim()]})),b(""))},C=f=>{w(A=>({...A,technologies:A.technologies.filter(G=>G!==f)}))},n=()=>{h.trim()&&!i.tags.includes(h.trim())&&(w(f=>({...f,tags:[...f.tags,h.trim()]})),m(""))},U=f=>{w(A=>({...A,tags:A.tags.filter(G=>G!==f)}))},q=()=>{const f={};return i.title.trim()||(f.title="กรุณาระบุชื่อโครงงาน"),i.description.trim()||(f.description="กรุณาระบุคำอธิบายโครงงาน"),i.category.trim()||(f.category="กรุณาระบุหมวดหมู่"),i.project_url&&!L(i.project_url)&&(f.project_url="กรุณาระบุ URL ที่ถูกต้อง"),i.github_url&&!L(i.github_url)&&(f.github_url="กรุณาระบุ URL ที่ถูกต้อง"),x(f),Object.keys(f).length===0},L=f=>{try{return new URL(f),!0}catch{return!1}},I=async f=>{if(f.preventDefault(),!q()){a({title:"ข้อมูลไม่ครบถ้วน",description:"กรุณาตรวจสอบข้อมูลที่กรอกและลองอีกครั้ง",variant:"destructive"});return}o(!0);try{let A={...i};if(A.duration_hours===""||A.duration_hours==="0"?A.duration_hours=null:A.duration_hours&&(A.duration_hours=parseInt(A.duration_hours)),Object.keys(A).forEach(v=>{A[v]===""&&v!=="title"&&v!=="description"&&v!=="category"&&(A[v]=null)}),(!A.technologies||A.technologies.length===0)&&(A.technologies=[]),(!A.tags||A.tags.length===0)&&(A.tags=[]),_){k(!0);const{data:v,error:D}=await De(_);if(D)throw new Error(`ไม่สามารถอัปโหลดรูปภาพได้: ${D.message}`);A.cover_image_url=v.publicUrl,k(!1)}const{data:G,error:B}=await ts(A);if(B)throw B;a({title:"สร้างโครงงานสำเร็จ! 🎉",description:`โครงงาน "${i.title}" ถูกสร้างเรียบร้อยแล้ว`}),w({title:"",description:"",short_description:"",category:"",difficulty_level:"beginner",duration_hours:"",is_featured:!1,technologies:[],project_url:"",github_url:"",video_url:"",cover_image_url:"",content_html:"",tags:[],status:"published"}),y(null),T(null),r&&r(G),t()}catch(A){console.error("Error creating project:",A),a({title:"ไม่สามารถสร้างโครงงานได้",description:A.message,variant:"destructive"})}finally{o(!1),k(!1)}},c=f=>{const A=f.target.files[0];if(!A)return;if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(A.type)){a({title:"ไฟล์ไม่ถูกต้อง",description:"กรุณาเลือกไฟล์รูปภาพ (JPG, PNG, WebP เท่านั้น)",variant:"destructive"});return}if(A.size>5*1024*1024){a({title:"ไฟล์ใหญ่เกินไป",description:"ขนาดไฟล์ต้องไม่เกิน 5MB",variant:"destructive"});return}y(A);const B=new FileReader;B.onload=v=>{T(v.target.result)},B.readAsDataURL(A)},$=()=>{y(null),T(null);const f=document.getElementById("project-image");f&&(f.value="")},M=["Web Development","Mobile App","Desktop App","IoT/Hardware","AI/Machine Learning","Data Science","Game Development","Other"],z=[{value:"beginner",label:"ผู้เริ่มต้น"},{value:"intermediate",label:"ปานกลาง"},{value:"advanced",label:"ขั้นสูง"}];return s?e.jsx(ge,{children:e.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:t,children:e.jsxs(R.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{type:"spring",duration:.3},className:"bg-white shadow-2xl rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-200",onClick:f=>f.stopPropagation(),children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 p-8 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-xl backdrop-blur-sm",children:e.jsx(se,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-white",children:"เพิ่มโครงงานใหม่"}),e.jsx("p",{className:"text-indigo-100 mt-1",children:"สร้างโครงงานและผลงานใหม่"})]})]}),e.jsx(E,{variant:"ghost",size:"icon",onClick:t,disabled:l,className:"text-white hover:bg-white/20 rounded-xl",children:e.jsx(le,{className:"w-6 h-6"})})]})}),e.jsx("div",{className:"p-8",children:e.jsxs("form",{onSubmit:I,className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-blue-500 p-2 rounded-lg mr-3",children:e.jsx(se,{className:"w-4 h-4 text-white"})}),"ชื่อโครงงาน *"]}),e.jsx(O,{name:"title",value:i.title,onChange:S,placeholder:"เช่น ระบบจัดการคอร์สออนไลน์",className:"bg-white border-gray-300 text-gray-800 text-lg h-12 focus:border-blue-500 focus:ring-blue-500 rounded-xl shadow-sm",error:u.title}),u.title&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),u.title]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-green-500 p-2 rounded-lg mr-3",children:e.jsx(K,{className:"w-4 h-4 text-white"})}),"คำอธิบายโครงงาน *"]}),e.jsx("textarea",{name:"description",value:i.description,onChange:S,placeholder:"อธิบายรายละเอียดโครงงาน วัตถุประสงค์ และฟีเจอร์หลัก...",rows:4,className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl text-gray-800 placeholder-gray-500 focus:border-green-500 focus:ring-2 focus:ring-green-200 text-base shadow-sm resize-none"}),u.description&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),u.description]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-sky-50 p-6 rounded-xl border border-blue-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-blue-500 p-2 rounded-lg mr-3",children:e.jsx(K,{className:"w-4 h-4 text-white"})}),"คำอธิบายสั้น"]}),e.jsx("textarea",{name:"short_description",value:i.short_description,onChange:S,placeholder:"คำอธิบายสั้นๆ สำหรับแสดงในการ์ด...",rows:4,className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl text-gray-800 placeholder-gray-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-base shadow-sm resize-none"})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 p-6 rounded-xl border border-purple-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-4 flex items-center",children:[e.jsx("div",{className:"bg-purple-500 p-2 rounded-lg mr-3",children:e.jsx(Xe,{className:"w-4 h-4 text-white"})}),"เทคโนโลยีที่ใช้"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(O,{name:"newTechnology",value:j,onChange:f=>b(f.target.value),placeholder:"เช่น React, Node.js, MongoDB",className:"bg-white border-gray-300 text-gray-800 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 rounded-xl shadow-sm",onKeyPress:f=>f.key==="Enter"&&(f.preventDefault(),N())}),e.jsx(E,{type:"button",onClick:N,className:"px-4 py-2 bg-purple-500 text-white rounded-xl",children:e.jsx(de,{className:"w-4 h-4"})})]}),i.technologies.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:i.technologies.map((f,A)=>e.jsxs("span",{className:"inline-flex items-center px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm",children:[f,e.jsx("button",{type:"button",onClick:()=>C(f),className:"ml-2 text-purple-600 hover:text-purple-800",children:e.jsx(le,{className:"w-3 h-3"})})]},A))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-rose-50 p-6 rounded-xl border border-pink-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-4 flex items-center",children:[e.jsx("div",{className:"bg-pink-500 p-2 rounded-lg mr-3",children:e.jsx(pe,{className:"w-4 h-4 text-white"})}),"แท็ก"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(O,{name:"newTag",value:h,onChange:f=>m(f.target.value),placeholder:"เช่น React, Frontend, Responsive",className:"bg-white border-gray-300 text-gray-800 focus:border-pink-500 focus:ring-2 focus:ring-pink-200 rounded-xl shadow-sm",onKeyPress:f=>f.key==="Enter"&&(f.preventDefault(),n())}),e.jsx(E,{type:"button",onClick:n,className:"px-4 py-2 bg-pink-500 text-white rounded-xl",children:e.jsx(de,{className:"w-4 h-4"})})]}),i.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:i.tags.map((f,A)=>e.jsxs("span",{className:"inline-flex items-center px-3 py-1 bg-pink-100 text-pink-800 rounded-full text-sm",children:[f,e.jsx("button",{type:"button",onClick:()=>U(f),className:"ml-2 text-pink-600 hover:text-pink-800",children:e.jsx(le,{className:"w-3 h-3"})})]},A))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 p-6 rounded-xl border border-orange-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-orange-500 p-2 rounded-lg mr-3",children:e.jsx(pe,{className:"w-4 h-4 text-white"})}),"หมวดหมู่ *"]}),e.jsxs("select",{name:"category",value:i.category,onChange:S,className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl text-gray-800 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 h-12 shadow-sm",children:[e.jsx("option",{value:"",children:"เลือกหมวดหมู่"}),M.map(f=>e.jsx("option",{value:f,children:f},f))]}),u.category&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),u.category]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-cyan-50 p-6 rounded-xl border border-teal-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-teal-500 p-2 rounded-lg mr-3",children:e.jsx(me,{className:"w-4 h-4 text-white"})}),"ระดับความยาก"]}),e.jsx("select",{name:"difficulty_level",value:i.difficulty_level,onChange:S,className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl text-gray-800 focus:border-teal-500 focus:ring-2 focus:ring-teal-200 h-12 shadow-sm",children:z.map(f=>e.jsx("option",{value:f.value,children:f.label},f.value))})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-blue-50 p-6 rounded-xl border border-indigo-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-indigo-500 p-2 rounded-lg mr-3",children:e.jsx(me,{className:"w-4 h-4 text-white"})}),"ระยะเวลาทำโครงงาน (ชั่วโมง)"]}),e.jsx(O,{name:"duration_hours",type:"number",value:i.duration_hours,onChange:S,placeholder:"เช่น 40",min:"0",className:"bg-white border-gray-300 text-gray-800 h-12 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 rounded-xl shadow-sm"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cyan-50 to-blue-50 p-6 rounded-xl border border-cyan-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-cyan-500 p-2 rounded-lg mr-3",children:e.jsx(Ze,{className:"w-4 h-4 text-white"})}),"Project URL"]}),e.jsx(O,{name:"project_url",value:i.project_url,onChange:S,placeholder:"https://example.com",className:"bg-white border-gray-300 text-gray-800 h-12 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 rounded-xl shadow-sm"}),u.project_url&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),u.project_url]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-slate-50 p-6 rounded-xl border border-gray-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-gray-500 p-2 rounded-lg mr-3",children:e.jsx(Re,{className:"w-4 h-4 text-white"})}),"GitHub URL"]}),e.jsx(O,{name:"github_url",value:i.github_url,onChange:S,placeholder:"https://github.com/username/repo",className:"bg-white border-gray-300 text-gray-800 h-12 focus:border-gray-500 focus:ring-2 focus:ring-gray-200 rounded-xl shadow-sm"}),u.github_url&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),u.github_url]})]})]}),e.jsx("div",{className:"bg-gradient-to-br from-yellow-50 to-amber-50 p-6 rounded-xl border border-yellow-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-yellow-500 p-2 rounded-lg",children:e.jsx(ue,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-gray-800 font-semibold",children:"โครงงานแนะนำ"}),e.jsx("p",{className:"text-sm text-gray-600",children:"แสดงในส่วนโครงงานที่แนะนำหน้าแรก"})]}),e.jsx("input",{type:"checkbox",name:"is_featured",checked:i.is_featured,onChange:S,className:"w-5 h-5 text-yellow-600 rounded focus:ring-yellow-500 focus:ring-2"})]})}),e.jsxs("div",{className:"bg-gradient-to-br from-rose-50 to-pink-50 p-6 rounded-xl border border-rose-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-4 flex items-center",children:[e.jsx("div",{className:"bg-rose-500 p-2 rounded-lg mr-3",children:e.jsx(Y,{className:"w-4 h-4 text-white"})}),"รูปภาพโครงงาน"]}),e.jsxs("div",{className:"space-y-4",children:[P&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:P,alt:"Project preview",className:"w-48 h-32 object-cover rounded-xl border-2 border-gray-200 shadow-lg"}),e.jsx(E,{type:"button",variant:"ghost",size:"icon",onClick:$,className:"absolute -top-2 -right-2 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full shadow-lg",children:e.jsx(Q,{className:"w-4 h-4"})})]}),!P&&e.jsxs("div",{className:"border-2 border-dashed border-rose-300 rounded-xl p-8 text-center hover:border-rose-400 transition-colors bg-white/50",children:[e.jsx("input",{type:"file",id:"project-image",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:c,className:"hidden",disabled:p}),e.jsxs("label",{htmlFor:"project-image",className:"cursor-pointer flex flex-col items-center space-y-3",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-rose-400 to-pink-500 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(Y,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-800 font-semibold text-lg",children:"เลือกรูปภาพ"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"JPG, PNG, WebP ขนาดไม่เกิน 5MB"}),e.jsx("p",{className:"text-rose-600 text-xs mt-2 font-medium",children:"คลิกเพื่ออัปโหลดไฟล์"})]})]})]}),p&&e.jsxs("div",{className:"flex items-center justify-center space-x-3 bg-blue-50 p-4 rounded-xl",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-blue-700 font-medium",children:"กำลังอัปโหลดรูปภาพ..."})]})]})]}),e.jsxs("div",{className:"flex justify-center space-x-4 pt-8",children:[e.jsx(E,{type:"button",variant:"outline",onClick:t,disabled:l,className:"px-8 py-3 text-gray-600 border-gray-300 hover:bg-gray-50 rounded-xl font-medium text-lg h-14 min-w-[120px]",children:"ยกเลิก"}),e.jsx(E,{type:"submit",disabled:l||p,className:"px-12 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-xl font-semibold text-lg h-14 min-w-[160px] shadow-lg hover:shadow-xl transition-all duration-200",children:l||p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),p?"กำลังอัปโหลดรูป...":"กำลังสร้าง..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-5 h-5 mr-3"}),"สร้างโครงงาน"]})})]})]})})]})})}):null},is=async()=>{try{console.log("Fetching dashboard statistics...");const{count:s,error:t}=await d.from("user_profiles").select("*",{count:"exact",head:!0});t&&console.warn("Could not fetch user count:",t);const r=new Date;r.setDate(r.getDate()-7);const{count:a,error:l}=await d.from("user_profiles").select("*",{count:"exact",head:!0}).gte("created_at",r.toISOString());l&&console.warn("Could not fetch new users count:",l);const{count:o,error:i}=await d.from("courses").select("*",{count:"exact",head:!0});i&&console.warn("Could not fetch courses count:",i);const{count:w,error:u}=await d.from("courses").select("*",{count:"exact",head:!0}).eq("is_active",!0);u&&console.warn("Could not fetch active courses count:",u);const{count:x,error:_}=await d.from("projects").select("*",{count:"exact",head:!0});_&&console.warn("Could not fetch projects count:",_);const{count:y,error:p}=await d.from("projects").select("*",{count:"exact",head:!0}).eq("is_approved",!0);p&&console.warn("Could not fetch approved projects count:",p);const{count:k,error:P}=await d.from("projects").select("*",{count:"exact",head:!0}).eq("is_approved",!1);P&&console.warn("Could not fetch pending projects count:",P);const{count:T,error:j}=await d.from("enrollments").select("*",{count:"exact",head:!0});j&&console.warn("Could not fetch enrollments count:",j);const{count:b,error:h}=await d.from("enrollments").select("*",{count:"exact",head:!0}).eq("is_active",!0);h&&console.warn("Could not fetch active enrollments count:",h);const m=s>0?Math.round(a/s*100):0,{data:S,error:N}=await d.from("projects").select("view_count");let C=0;!N&&S&&(C=S.reduce((U,q)=>U+(q.view_count||0),0));const n={totalUsers:s||0,activeUsers:Math.round((s||0)*.15),newUsersToday:Math.round((a||0)/7),userGrowth:m,newUsersWeek:a||0,totalCourses:o||0,activeCourses:w||0,draftCourses:(o||0)-(w||0),courseEnrollments:T||0,totalProjects:x||0,approvedProjects:y||0,pendingApproval:k||0,featuredProjects:Math.round((y||0)*.2),projectViews:C,systemUptime:99.8,serverLoad:Math.round(Math.random()*30+40),storageUsed:2.4,activeSessions:Math.round((s||0)*.1)};return console.log("Dashboard stats calculated:",n),{data:n,error:null}}catch(s){return console.error("Error fetching dashboard stats:",s),{data:{totalUsers:0,activeUsers:0,newUsersToday:0,userGrowth:0,totalCourses:0,activeCourses:0,draftCourses:0,courseEnrollments:0,totalProjects:0,approvedProjects:0,pendingApproval:0,featuredProjects:0,projectViews:0,systemUptime:0,serverLoad:0,storageUsed:0,activeSessions:0},error:s}}},cs=async()=>{try{const s=[],{data:t,error:r}=await d.from("user_profiles").select("full_name, email, created_at").order("created_at",{ascending:!1}).limit(5);!r&&t&&t.forEach(u=>{s.push({type:"user_registration",title:"ผู้ใช้ใหม่ลงทะเบียน",description:`${u.full_name||u.email} เข้าร่วมระบบ`,timestamp:u.created_at,icon:"user-plus"})});const{data:a,error:l}=await d.from("courses").select("title, updated_at").order("updated_at",{ascending:!1}).limit(3);!l&&a&&a.forEach(u=>{s.push({type:"course_update",title:"คอร์สมีการอัปเดต",description:`"${u.title}" ได้รับการปรับปรุง`,timestamp:u.updated_at,icon:"book-open"})});const{data:o,error:i}=await d.from("projects").select("title, created_at").order("created_at",{ascending:!1}).limit(3);return!i&&o&&o.forEach(u=>{s.push({type:"project_submission",title:"โครงงานใหม่",description:`"${u.title}" ถูกส่งเพื่อขออนุมัติ`,timestamp:u.created_at,icon:"folder-plus"})}),{data:s.sort((u,x)=>new Date(x.timestamp)-new Date(u.timestamp)).slice(0,10),error:null}}catch(s){return console.error("Error fetching recent activity:",s),{data:[],error:s}}},ds=async()=>{try{const{error:s}=await d.from("user_profiles").select("id",{count:"exact",head:!0}).limit(1),t=s?"error":"healthy";return{data:{database:{status:t,responseTime:Math.round(Math.random()*50+10)},storage:{status:"healthy",usage:45},api:{status:"healthy",responseTime:Math.round(Math.random()*100+50)},overall:t==="healthy"?"healthy":"warning"},error:null}}catch(s){return console.error("Error fetching system health:",s),{data:{database:{status:"error",responseTime:0},storage:{status:"unknown",usage:0},api:{status:"error",responseTime:0},overall:"error"},error:s}}},ms=()=>{const{user:s}=Ve(),{toast:t}=ee(),r=Ce(),[a,l]=g.useState("overview"),[o,i]=g.useState(null),[w,u]=g.useState(!0),[x,_]=g.useState([]),[y,p]=g.useState(null);g.useEffect(()=>{(async()=>{try{u(!0);const{data:S,error:N}=await is();N?(console.error("Error loading dashboard stats:",N),t({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลแดชบอร์ดได้",variant:"destructive"})):i(S);const{data:C,error:n}=await cs();n||_(C);const{data:U,error:q}=await ds();q||p(U)}catch(S){console.error("Error loading dashboard:",S),t({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลแดชบอร์ดได้",variant:"destructive"})}finally{u(!1)}})()},[t]);const k=[{id:"overview",label:"ภาพรวม",icon:ve},{id:"users",label:"ผู้ใช้",icon:Z},{id:"courses",label:"คอร์ส",icon:ie},{id:"projects",label:"โครงงาน",icon:se},{id:"customize",label:"ปรับแต่ง",icon:ce}],P=o?[{title:"ผู้ใช้งานระบบ",value:o.totalUsers.toLocaleString(),change:`+${o.userGrowth}%`,changeType:"positive",subtitle:`${o.activeUsers} คนออนไลน์`,icon:Z,color:"blue",path:"/admin/users"},{title:"คอร์สเรียน",value:o.totalCourses,change:`${o.activeCourses} เปิดใช้งาน`,changeType:"neutral",subtitle:`${o.courseEnrollments.toLocaleString()} การลงทะเบียน`,icon:ie,color:"green",path:"/admin/courses"},{title:"โครงงาน",value:o.totalProjects,change:`${o.featuredProjects} แนะนำ`,changeType:"neutral",subtitle:`${o.projectViews.toLocaleString()} ยอดดู`,icon:se,color:"purple",path:"/admin/projects"},{title:"สถานะระบบ",value:`${o.systemUptime}%`,change:`${o.serverLoad}% load`,changeType:o.serverLoad>80?"negative":"positive",subtitle:`${o.activeSessions} sessions`,icon:Ye,color:"emerald"}]:[],T=o?[{title:"ผู้ใช้ใหม่วันนี้",value:o.newUsersToday,icon:Pe,color:"bg-blue-50 text-blue-600",trend:"up"},{title:"คอร์สรอการอนุมัติ",value:o.draftCourses,icon:re,color:"bg-orange-50 text-orange-600",trend:"neutral"},{title:"โครงงานรอการอนุมัติ",value:o.pendingApproval,icon:be,color:"bg-yellow-50 text-yellow-600",trend:"neutral"},{title:"พื้นที่จัดเก็บ",value:`${o.storageUsed}GB`,icon:Qe,color:"bg-purple-50 text-purple-600",trend:"up"}]:[],j=()=>w?e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:[1,2,3,4].map(m=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"w-16 h-6 bg-gray-200 rounded-full"})]}),e.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"w-16 h-8 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"w-20 h-4 bg-gray-200 rounded"})]})},m))}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"w-32 h-6 bg-gray-200 rounded mb-6"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[1,2,3,4].map(m=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg mx-auto mb-2"}),e.jsx("div",{className:"w-16 h-4 bg-gray-200 rounded mx-auto mb-1"}),e.jsx("div",{className:"w-12 h-6 bg-gray-200 rounded mx-auto"})]},m))})]})})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6",children:P.map((m,S)=>e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:S*.1},className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>m.path&&r(m.path),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg bg-${m.color}-100`,children:e.jsx(m.icon,{className:`w-6 h-6 text-${m.color}-600`})}),e.jsx("div",{className:`text-sm font-medium px-2 py-1 rounded-full ${m.changeType==="positive"?"bg-green-100 text-green-800":m.changeType==="negative"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:m.change})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-1",children:m.title}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mb-1",children:m.value}),e.jsx("p",{className:"text-sm text-gray-500",children:m.subtitle})]}),m.path&&e.jsxs("div",{className:"mt-4 flex items-center text-sm text-blue-600",children:[e.jsx("span",{children:"ดูรายละเอียด"}),e.jsx(ae,{className:"w-4 h-4 ml-1"})]})]},m.title))}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center",children:[e.jsx(tt,{className:"w-5 h-5 mr-2 text-blue-600"}),"ข้อมูลสำคัญ"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:T.map((m,S)=>e.jsxs(R.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.5+S*.1},className:"text-center p-4 rounded-lg border border-gray-100 hover:border-gray-200 transition-colors",children:[e.jsx("div",{className:`inline-flex p-3 rounded-full ${m.color} mb-3`,children:e.jsx(m.icon,{className:"w-5 h-5"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:m.value}),e.jsx("p",{className:"text-sm text-gray-600",children:m.title})]},m.title))})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(re,{className:"w-5 h-5 mr-2 text-green-600"}),"กิจกรรมล่าสุด"]}),e.jsx(E,{variant:"outline",size:"sm",children:"ดูทั้งหมด"})]}),e.jsx("div",{className:"space-y-4",children:x.length>0?x.map((m,S)=>e.jsxs(R.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.8+S*.1},className:"flex items-center space-x-4 p-3 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:`p-2 rounded-full ${m.type==="user_registration"?"bg-blue-100 text-blue-600":m.type==="course_update"?"bg-green-100 text-green-600":m.type==="project_submission"?"bg-purple-100 text-purple-600":"bg-gray-100 text-gray-600"}`,children:[m.icon==="user-plus"&&e.jsx(Z,{className:"w-4 h-4"}),m.icon==="book-open"&&e.jsx(ie,{className:"w-4 h-4"}),m.icon==="folder-plus"&&e.jsx(se,{className:"w-4 h-4"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:m.title}),e.jsx("p",{className:"text-sm text-gray-600",children:m.description})]}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(m.timestamp).toLocaleString("th-TH")})]},S)):e.jsx("div",{className:"text-center py-4 text-gray-500",children:"ไม่มีกิจกรรมล่าสุด"})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center",children:[e.jsx(st,{className:"w-5 h-5 mr-2 text-purple-600"}),"การดำเนินการด่วน"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(te,{to:"/admin/users",children:e.jsxs(E,{variant:"outline",className:"w-full justify-start",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"เพิ่มผู้ใช้ใหม่"]})}),e.jsx(te,{to:"/admin/courses",children:e.jsxs(E,{variant:"outline",className:"w-full justify-start",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"สร้างคอร์สใหม่"]})}),e.jsx(te,{to:"/admin/projects",children:e.jsxs(E,{variant:"outline",className:"w-full justify-start",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"จัดการโครงงาน"]})}),e.jsxs(E,{variant:"outline",className:"w-full justify-start",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"ตั้งค่าระบบ"]}),e.jsxs(E,{variant:"outline",className:"w-full justify-start",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"ดูรายงาน"]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"สถานะเซิร์ฟเวอร์"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"w-4 h-4 text-green-500 mr-1"}),e.jsx("span",{className:"text-green-600",children:"ปกติ"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-gray-600",children:"การเชื่อมต่อ"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(rt,{className:"w-4 h-4 text-green-500 mr-1"}),e.jsxs("span",{className:"text-green-600",children:[(o==null?void 0:o.activeSessions)||0," sessions"]})]})]})]})]})]})]}),b=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center",children:[e.jsx(ie,{className:"w-5 h-5 mr-2 text-blue-600"}),"ปรับแต่งคอร์สเรียน"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[{title:"ธีมและสี",desc:"ปรับแต่งสีและธีมของคอร์ส",icon:qe,color:"purple"},{title:"รูปภาพปก",desc:"จัดการรูปภาพปกคอร์ส",icon:Y,color:"green"},{title:"เนื้อหา",desc:"แก้ไขรายละเอียดคอร์ส",icon:ze,color:"orange"},{title:"การตั้งค่า",desc:"ตั้งค่าการเข้าถึงและราคา",icon:ce,color:"gray"},{title:"ไฟล์แนบ",desc:"จัดการไฟล์และเอกสาร",icon:Ne,color:"blue"},{title:"ตัวอย่าง",desc:"ดูตัวอย่างคอร์ส",icon:ae,color:"indigo"}].map(m=>e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg hover:border-gray-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(m.icon,{className:`w-5 h-5 text-${m.color}-600`}),e.jsx("h3",{className:"font-medium text-gray-900",children:m.title})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:m.desc}),e.jsx(E,{variant:"outline",size:"sm",className:"w-full",children:"จัดการ"})]},m.title))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center",children:[e.jsx(se,{className:"w-5 h-5 mr-2 text-purple-600"}),"ปรับแต่งโครงงาน"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[{title:"ธีมโครงงาน",desc:"ปรับแต่งธีมการแสดงผล",icon:qe,color:"purple"},{title:"แกลเลอรี่",desc:"จัดการรูปภาพโครงงาน",icon:Y,color:"green"},{title:"รายละเอียด",desc:"แก้ไขข้อมูลโครงงาน",icon:ze,color:"orange"},{title:"สถานะ",desc:"จัดการสถานะและการแสดง",icon:ce,color:"gray"},{title:"ไฟล์โครงงาน",desc:"อัปโหลดไฟล์และเอกสาร",icon:Ne,color:"blue"},{title:"แสดงผล",desc:"ดูผลการแสดงโครงงาน",icon:ae,color:"indigo"}].map(m=>e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg hover:border-gray-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(m.icon,{className:`w-5 h-5 text-${m.color}-600`}),e.jsx("h3",{className:"font-medium text-gray-900",children:m.title})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:m.desc}),e.jsx(E,{variant:"outline",size:"sm",className:"w-full",children:"จัดการ"})]},m.title))})]})]}),h=()=>{switch(a){case"overview":return j();case"users":return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"จัดการผู้ใช้"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"หน้าจัดการผู้ใช้งานระบบ"}),e.jsx(te,{to:"/admin/users",children:e.jsx(E,{children:"ไปยังหน้าจัดการผู้ใช้"})})]});case"courses":return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"จัดการคอร์ส"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"หน้าจัดการคอร์สเรียน"}),e.jsx(te,{to:"/admin/courses",children:e.jsx(E,{children:"ไปยังหน้าจัดการคอร์ส"})})]});case"projects":return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"จัดการโครงงาน"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"หน้าจัดการโครงงาน"}),e.jsx(te,{to:"/admin/projects",children:e.jsx(E,{children:"ไปยังหน้าจัดการโครงงาน"})})]});case"customize":return b();default:return j()}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs(he,{children:[e.jsx("title",{children:"แดชบอร์ดผู้ดูแลระบบ - Login Learning"}),e.jsx("meta",{name:"description",content:"แดชบอร์ดสำหรับจัดการระบบ Login Learning"})]}),e.jsxs("div",{className:"w-full mx-auto",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-500 to-purple-600 p-3 rounded-xl",children:e.jsx(et,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"แดชบอร์ดผู้ดูแลระบบ"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["ยินดีต้อนรับ, ",s==null?void 0:s.email]})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:new Date().toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"})})]})})]}),e.jsx("div",{className:"flex space-x-1 border-b border-gray-200",children:k.map(m=>{const S=m.icon;return e.jsx("button",{onClick:()=>l(m.id),className:`px-6 py-3 text-sm font-medium rounded-t-lg transition-all duration-200 ${a===m.id?"bg-blue-50 text-blue-700 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:m.label})]})},m.id)})})]})}),e.jsx("div",{className:"px-6 py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:h()},a)})})]})]})},Hs=Object.freeze(Object.defineProperty({__proto__:null,default:ms},Symbol.toStringTag,{value:"Module"})),us=()=>{const{toast:s}=ee(),t=Ce(),[r,a]=ne.useState(""),[l,o]=ne.useState([]),[i,w]=ne.useState(!0);ne.useEffect(()=>{(async()=>{var k;try{w(!0);const{data:P,error:T}=await Qt();T&&(console.error("Database error:",T),T.code!=="PGRST200"&&s({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลผู้ใช้ได้",variant:"destructive"})),o(P||[])}catch(P){console.error("Error loading users:",P),(k=P.message)!=null&&k.includes("relationship")||s({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถโหลดข้อมูลผู้ใช้ได้",variant:"destructive"})}finally{w(!1)}})()},[s]);const u=async(p,k)=>{try{const{data:P,error:T}=await es(p,k);if(T)throw T;o(j=>j.map(b=>b.user_id===p?{...b,role:k}:b)),s({title:"อัพเดทสำเร็จ",description:`เปลี่ยนบทบาทผู้ใช้เป็น ${k} แล้ว`})}catch(P){console.error("Error updating user role:",P),s({title:"เกิดข้อผิดพลาด",description:`ไม่สามารถอัพเดทบทบาทได้: ${P.message}`,variant:"destructive"})}},x=p=>{s({title:`🚧 ฟีเจอร์ "${p}" ยังไม่พร้อมใช้งาน`,description:"เรากำลังพัฒนาส่วนนี้สำหรับผู้ดูแลระบบ โปรดรอติดตาม! 🚀"})},_=l.filter(p=>{var k,P;return((k=p.full_name)==null?void 0:k.toLowerCase().includes(r.toLowerCase()))||!1||((P=p.email)==null?void 0:P.toLowerCase().includes(r.toLowerCase()))||!1}),y={initial:{opacity:0,y:20},in:{opacity:1,y:0},out:{opacity:0,y:-20}};return e.jsxs(R.div,{initial:"initial",animate:"in",exit:"out",variants:y,className:"container mx-auto px-4 py-12",children:[e.jsxs(he,{children:[e.jsx("title",{children:"จัดการผู้ใช้ - ผู้ดูแลระบบ Login Learning"}),e.jsx("meta",{name:"description",content:"จัดการข้อมูลผู้ใช้งานทั้งหมดในระบบ Login Learning"})]}),e.jsxs(R.div,{initial:{y:-30,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,delay:.1},className:"flex flex-col sm:flex-row justify-between items-center mb-10",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(E,{variant:"ghost",size:"sm",onClick:()=>t("/admin"),className:"mr-4 text-gray-600 hover:text-gray-900",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"ย้อนกลับ"]}),e.jsxs("h1",{className:"text-3xl lg:text-4xl font-bold text-teal-900 mb-4 sm:mb-0",children:[e.jsx(Z,{className:"inline-block w-8 h-8 mr-3 text-[#667eea]"}),"จัดการผู้ใช้งาน"]})]}),e.jsxs(E,{onClick:()=>x("เพิ่มผู้ใช้ใหม่"),className:"bg-gradient-to-r from-[#667eea] to-[#764ba2] hover:from-[#5a6fcf] hover:to-[#673f8b] text-gray-800",children:[e.jsx(Pe,{className:"w-5 h-5 mr-2"}),"เพิ่มผู้ใช้ใหม่"]})]}),e.jsx("div",{className:"mb-6 glass-effect p-4 rounded-xl",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(O,{type:"text",placeholder:"ค้นหาผู้ใช้ (ชื่อ, อีเมล)...",value:r,onChange:p=>a(p.target.value),className:"pl-10 w-full bg-slate-200 border-slate-400 text-gray-900 focus:border-[#667eea]"})]})}),e.jsxs("div",{className:"glass-effect rounded-xl shadow-xl overflow-x-auto",children:[e.jsxs("table",{className:"w-full min-w-max text-left text-teal-800",children:[e.jsx("thead",{className:"border-b border-slate-700",children:e.jsxs("tr",{className:"bg-teal-100/30",children:[e.jsx("th",{className:"p-4",children:"ชื่อ-นามสกุล"}),e.jsx("th",{className:"p-4",children:"อีเมล"}),e.jsx("th",{className:"p-4",children:"บทบาท"}),e.jsx("th",{className:"p-4",children:"วันที่เข้าร่วม"}),e.jsx("th",{className:"p-4 text-center",children:"การดำเนินการ"})]})}),e.jsx("tbody",{children:_.map((p,k)=>e.jsxs(R.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:k*.05},className:"border-b border-slate-700/50 hover:bg-slate-700/20 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:p.full_name||"ไม่ระบุชื่อ"}),p.school_name&&e.jsx("div",{className:"text-sm text-gray-500",children:p.school_name})]})}),e.jsx("td",{className:"p-4",children:p.email||"ไม่ระบุอีเมล"}),e.jsx("td",{className:"p-4",children:e.jsxs("select",{value:p.role||"student",onChange:P=>u(p.user_id,P.target.value),className:`px-2 py-1 text-xs rounded-full border-0 ${(p.role||"student")==="admin"?"bg-red-500/30 text-red-300":(p.role||"student")==="instructor"?"bg-blue-500/30 text-blue-300":(p.role||"student")==="branch_manager"?"bg-purple-500/30 text-purple-300":"bg-green-500/30 text-green-300"}`,children:[e.jsx("option",{value:"student",children:"Student"}),e.jsx("option",{value:"instructor",children:"Instructor"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"branch_manager",children:"Branch Manager"})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",children:p.joinedDate}),e.jsxs("div",{className:"text-xs text-gray-500",children:[p.enrollmentCount," คอร์ส"]})]})}),e.jsxs("td",{className:"p-4 text-center space-x-2",children:[e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>x(`แก้ไขผู้ใช้ ${p.full_name||"ไม่ระบุชื่อ"}`),className:"text-blue-400 hover:bg-blue-500/20",children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>x(`ลบผู้ใช้ ${p.full_name||"ไม่ระบุชื่อ"}`),className:"text-red-400 hover:bg-red-500/20",children:e.jsx(Q,{className:"w-4 h-4"})})]})]},p.user_id))})]}),i?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"กำลังโหลดข้อมูลผู้ใช้..."})]}):_.length===0?e.jsx("p",{className:"text-center p-6 text-teal-700",children:l.length===0?"ไม่มีข้อมูลผู้ใช้ในระบบ":"ไม่พบผู้ใช้งานที่ตรงกับการค้นหา"}):null]})]})},Ks=Object.freeze(Object.defineProperty({__proto__:null,default:us},Symbol.toStringTag,{value:"Module"})),xs=({isOpen:s,onClose:t,onSuccess:r})=>{const{toast:a}=ee(),[l,o]=g.useState(!1),[i,w]=g.useState({title:"",description:"",category:"",level:"beginner",duration_hours:0,price:0,max_students:50,is_active:!0,thumbnail_url:""}),[u,x]=g.useState({}),[_,y]=g.useState(null),[p,k]=g.useState(!1),[P,T]=g.useState(null),j=n=>{const{name:U,value:q,type:L}=n.target;w(I=>({...I,[U]:L==="number"?parseFloat(q)||0:q})),u[U]&&x(I=>({...I,[U]:""}))},b=()=>{const n={};return i.title.trim()||(n.title="กรุณาระบุชื่อคอร์ส"),i.description.trim()||(n.description="กรุณาระบุคำอธิบายคอร์ส"),i.category.trim()||(n.category="กรุณาระบุหมวดหมู่"),i.duration_hours<=0&&(n.duration_hours="ระยะเวลาต้องมากกว่า 0 ชั่วโมง"),i.price<0&&(n.price="ราคาต้องไม่เป็นลบ"),i.max_students<=0&&(n.max_students="จำนวนนักเรียนสูงสุดต้องมากกว่า 0"),x(n),Object.keys(n).length===0},h=async n=>{if(n.preventDefault(),!b()){a({title:"ข้อมูลไม่ครบถ้วน",description:"กรุณาตรวจสอบข้อมูลที่กรอกและลองอีกครั้ง",variant:"destructive"});return}o(!0);try{let U={...i};if(_){k(!0);const{data:I,error:c}=await De(_);if(c)throw new Error(`ไม่สามารถอัปโหลดรูปหน้าปกได้: ${c.message}`);U.thumbnail_url=I.publicUrl,k(!1)}const{data:q,error:L}=await Lt(U);if(L)throw L;a({title:"สร้างคอร์สสำเร็จ! 🎉",description:`คอร์ส "${i.title}" ถูกสร้างเรียบร้อยแล้ว`}),w({title:"",description:"",category:"",level:"beginner",duration_hours:0,price:0,max_students:50,is_active:!0,thumbnail_url:""}),y(null),T(null),r&&r(q),t()}catch(U){console.error("Error creating course:",U),a({title:"ไม่สามารถสร้างคอร์สได้",description:U.message,variant:"destructive"})}finally{o(!1),k(!1)}},m=n=>{const U=n.target.files[0];if(!U)return;if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(U.type)){a({title:"ไฟล์ไม่ถูกต้อง",description:"กรุณาเลือกไฟล์รูปภาพ (JPG, PNG, WebP เท่านั้น)",variant:"destructive"});return}if(U.size>5*1024*1024){a({title:"ไฟล์ใหญ่เกินไป",description:"ขนาดไฟล์ต้องไม่เกิน 5MB",variant:"destructive"});return}y(U);const L=new FileReader;L.onload=I=>{T(I.target.result)},L.readAsDataURL(U)},S=()=>{y(null),T(null);const n=document.getElementById("cover-image");n&&(n.value="")},N=["Electronics","Civil Engineering","Energy","Software","Design","Robotics","Mechanical","Chemical","Environmental"],C=[{value:"beginner",label:"ผู้เริ่มต้น"},{value:"intermediate",label:"ระดับกลาง"},{value:"advanced",label:"ระดับสูง"}];return s?e.jsx(ge,{children:e.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:t,children:e.jsxs(R.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{type:"spring",duration:.3},className:"bg-white shadow-2xl rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gray-200",onClick:n=>n.stopPropagation(),children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 p-8 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-xl backdrop-blur-sm",children:e.jsx(xe,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-white",children:"เพิ่มคอร์สใหม่"}),e.jsx("p",{className:"text-indigo-100 mt-1",children:"สร้างคอร์สเรียนใหม่สำหรับนักเรียน"})]})]}),e.jsx(E,{variant:"ghost",size:"icon",onClick:t,disabled:l,className:"text-white hover:bg-white/20 rounded-xl",children:e.jsx(le,{className:"w-6 h-6"})})]})}),e.jsx("div",{className:"p-8",children:e.jsxs("form",{onSubmit:h,className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-blue-500 p-2 rounded-lg mr-3",children:e.jsx(xe,{className:"w-4 h-4 text-white"})}),"ชื่อคอร์ส *"]}),e.jsx(O,{name:"title",value:i.title,onChange:j,placeholder:"เช่น Arduino Automation Systems",className:"bg-white border-gray-300 text-gray-800 text-lg h-12 focus:border-blue-500 focus:ring-blue-500 rounded-xl shadow-sm",error:u.title}),u.title&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),u.title]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-green-500 p-2 rounded-lg mr-3",children:e.jsx(K,{className:"w-4 h-4 text-white"})}),"คำอธิบายคอร์ส *"]}),e.jsx("textarea",{name:"description",value:i.description,onChange:j,placeholder:`อธิบายเนื้อหาและสิ่งที่นักเรียนจะได้เรียนรู้...

สามารถเว้นบรรทัดได้โดยการกด Enter`,rows:4,className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl text-gray-800 placeholder-gray-500 focus:border-green-500 focus:ring-2 focus:ring-green-200 text-base shadow-sm resize-none"}),u.description&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),u.description]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 p-6 rounded-xl border border-purple-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-purple-500 p-2 rounded-lg mr-3",children:e.jsx(pe,{className:"w-4 h-4 text-white"})}),"หมวดหมู่ *"]}),e.jsxs("select",{name:"category",value:i.category,onChange:j,className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl text-gray-800 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 h-12 shadow-sm",children:[e.jsx("option",{value:"",children:"เลือกหมวดหมู่"}),N.map(n=>e.jsx("option",{value:n,children:n},n))]}),u.category&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),u.category]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 p-6 rounded-xl border border-amber-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-amber-500 p-2 rounded-lg mr-3",children:e.jsx(Z,{className:"w-4 h-4 text-white"})}),"ระดับความยาก"]}),e.jsx("select",{name:"level",value:i.level,onChange:j,className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl text-gray-800 focus:border-amber-500 focus:ring-2 focus:ring-amber-200 h-12 shadow-sm",children:C.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cyan-50 to-blue-50 p-6 rounded-xl border border-cyan-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-cyan-500 p-2 rounded-lg mr-3",children:e.jsx(re,{className:"w-4 h-4 text-white"})}),"ระยะเวลา (ชั่วโมง) *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(O,{type:"number",name:"duration_hours",value:i.duration_hours,onChange:j,placeholder:"40",min:"0",className:"pl-12 pr-4 bg-white border-gray-300 text-gray-800 h-12 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 rounded-xl shadow-sm text-lg"})]}),u.duration_hours&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),u.duration_hours]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-green-50 p-6 rounded-xl border border-emerald-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-emerald-500 p-2 rounded-lg mr-3",children:e.jsx(ye,{className:"w-4 h-4 text-white"})}),"ราคา (บาท)"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(O,{type:"number",name:"price",value:i.price,onChange:j,placeholder:"2500",min:"0",step:"0.01",className:"pl-12 pr-4 bg-white border-gray-300 text-gray-800 h-12 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 rounded-xl shadow-sm text-lg"})]}),u.price&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),u.price]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-rose-50 to-pink-50 p-6 rounded-xl border border-rose-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-rose-500 p-2 rounded-lg mr-3",children:e.jsx(Z,{className:"w-4 h-4 text-white"})}),"จำนวนนักเรียนสูงสุด *"]}),e.jsxs("div",{className:"relative max-w-xs",children:[e.jsx(Z,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(O,{type:"number",name:"max_students",value:i.max_students,onChange:j,placeholder:"50",min:"1",className:"pl-12 pr-4 bg-white border-gray-300 text-gray-800 h-12 focus:border-rose-500 focus:ring-2 focus:ring-rose-200 rounded-xl shadow-sm text-lg"})]}),u.max_students&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),u.max_students]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-cyan-50 p-6 rounded-xl border border-teal-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-4 flex items-center",children:[e.jsx("div",{className:"bg-teal-500 p-2 rounded-lg mr-3",children:e.jsx(Y,{className:"w-4 h-4 text-white"})}),"รูปหน้าปกคอร์ส"]}),e.jsxs("div",{className:"space-y-4",children:[P&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:P,alt:"Course cover preview",className:"w-48 h-32 object-cover rounded-xl border-2 border-gray-200 shadow-lg"}),e.jsx(E,{type:"button",variant:"ghost",size:"icon",onClick:S,className:"absolute -top-2 -right-2 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full shadow-lg",children:e.jsx(Q,{className:"w-4 h-4"})})]}),!P&&e.jsxs("div",{className:"border-2 border-dashed border-teal-300 rounded-xl p-8 text-center hover:border-teal-400 transition-colors bg-white/50",children:[e.jsx("input",{type:"file",id:"cover-image",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:m,className:"hidden",disabled:p}),e.jsxs("label",{htmlFor:"cover-image",className:"cursor-pointer flex flex-col items-center space-y-3",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-teal-400 to-cyan-500 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(Y,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-800 font-semibold text-lg",children:"เลือกรูปหน้าปก"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"JPG, PNG, WebP ขนาดไม่เกิน 5MB"}),e.jsx("p",{className:"text-teal-600 text-xs mt-2 font-medium",children:"คลิกเพื่ออัปโหลดไฟล์"})]})]})]}),p&&e.jsxs("div",{className:"flex items-center justify-center space-x-3 bg-blue-50 p-4 rounded-xl",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-blue-700 font-medium",children:"กำลังอัปโหลดรูปภาพ..."})]})]})]}),e.jsxs("div",{className:"flex justify-center space-x-4 pt-8",children:[e.jsx(E,{type:"button",variant:"outline",onClick:t,disabled:l,className:"px-8 py-3 text-gray-600 border-gray-300 hover:bg-gray-50 rounded-xl font-medium text-lg h-14 min-w-[120px]",children:"ยกเลิก"}),e.jsx(E,{type:"submit",disabled:l||p,className:"px-12 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-xl font-semibold text-lg h-14 min-w-[160px] shadow-lg hover:shadow-xl transition-all duration-200",children:l||p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),p?"กำลังอัปโหลดรูป...":"กำลังสร้าง..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-5 h-5 mr-3"}),"สร้างคอร์ส"]})})]})]})})]})})}):null},hs=({isOpen:s,onClose:t,onSuccess:r,courseId:a})=>{const{toast:l}=ee(),[o,i]=g.useState(!1),[w,u]=g.useState(!0),[x,_]=g.useState({title:"",description:"",category:"",level:"beginner",duration_hours:0,price:0,instructor_name:"",instructor_email:"",max_students:50,is_active:!0,image_url:"",learning_outcomes:[""],tools_required:[""]}),[y,p]=g.useState({}),[k,P]=g.useState(null),[T,j]=g.useState(!1),[b,h]=g.useState(null),[m,S]=g.useState(!1);g.useEffect(()=>{s&&a&&N()},[s,a]);const N=async()=>{try{u(!0);const{data:v,error:D}=await qt(a);if(D)throw D;let F=[""],V=[""];try{v.learning_outcomes&&(F=typeof v.learning_outcomes=="string"?JSON.parse(v.learning_outcomes):v.learning_outcomes),v.tools_required&&(V=typeof v.tools_required=="string"?JSON.parse(v.tools_required):v.tools_required)}catch(J){console.warn("Error parsing course data:",J)}_({title:v.title||"",description:v.description||"",category:v.category||"",level:v.level||"beginner",duration_hours:v.duration_hours||0,price:v.price||0,instructor_name:v.instructor_name||"",instructor_email:v.instructor_email||"",max_students:v.max_students||50,is_active:v.is_active!==void 0?v.is_active:!0,image_url:v.image_url||"",learning_outcomes:F,tools_required:V}),v.image_url&&h(v.image_url)}catch(v){console.error("Error loading course:",v),l({title:"ไม่สามารถโหลดข้อมูลคอร์สได้",description:v.message,variant:"destructive"})}finally{u(!1)}},C=v=>{const{name:D,value:F,type:V}=v.target;_(J=>({...J,[D]:V==="number"?parseFloat(F)||0:F})),y[D]&&p(J=>({...J,[D]:""}))},n=()=>{_(v=>({...v,learning_outcomes:[...v.learning_outcomes,""]}))},U=v=>{_(D=>({...D,learning_outcomes:D.learning_outcomes.filter((F,V)=>V!==v)}))},q=(v,D)=>{_(F=>({...F,learning_outcomes:F.learning_outcomes.map((V,J)=>J===v?D:V)}))},L=()=>{_(v=>({...v,tools_required:[...v.tools_required,""]}))},I=v=>{_(D=>({...D,tools_required:D.tools_required.filter((F,V)=>V!==v)}))},c=(v,D)=>{_(F=>({...F,tools_required:F.tools_required.map((V,J)=>J===v?D:V)}))},$=()=>{const v={};return x.title.trim()||(v.title="กรุณาระบุชื่อคอร์ส"),x.description.trim()||(v.description="กรุณาระบุคำอธิบายคอร์ส"),x.category.trim()||(v.category="กรุณาระบุหมวดหมู่"),x.instructor_name.trim()||(v.instructor_name="กรุณาระบุชื่ออาจารย์"),x.duration_hours<=0&&(v.duration_hours="ระยะเวลาต้องมากกว่า 0 ชั่วโมง"),x.price<0&&(v.price="ราคาต้องไม่เป็นลบ"),x.max_students<=0&&(v.max_students="จำนวนนักเรียนสูงสุดต้องมากกว่า 0"),p(v),Object.keys(v).length===0},M=async v=>{if(v.preventDefault(),!$()){l({title:"ข้อมูลไม่ครบถ้วน",description:"กรุณาตรวจสอบข้อมูลที่กรอกและลองอีกครั้ง",variant:"destructive"});return}i(!0);try{let D={...x};if(k){j(!0);const{data:J,error:$e}=await De(k);if($e)throw new Error(`ไม่สามารถอัปโหลดรูปหน้าปกได้: ${$e.message}`);D.image_url=J.publicUrl,j(!1)}D.learning_outcomes=D.learning_outcomes.filter(J=>J.trim()!==""),D.tools_required=D.tools_required.filter(J=>J.trim()!=="");const{data:F,error:V}=await It(a,D);if(V)throw V;l({title:"อัปเดตคอร์สสำเร็จ! 🎉",description:`คอร์ส "${x.title}" ถูกอัปเดตเรียบร้อยแล้ว`}),r&&r(F),t()}catch(D){console.error("Error updating course:",D),l({title:"ไม่สามารถอัปเดตคอร์สได้",description:D.message,variant:"destructive"})}finally{i(!1),j(!1)}},z=v=>{const D=v.target.files[0];if(!D)return;if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(D.type)){l({title:"ไฟล์ไม่ถูกต้อง",description:"กรุณาเลือกไฟล์รูปภาพ (JPG, PNG, WebP เท่านั้น)",variant:"destructive"});return}if(D.size>5*1024*1024){l({title:"ไฟล์ใหญ่เกินไป",description:"ขนาดไฟล์ต้องไม่เกิน 5MB",variant:"destructive"});return}P(D);const V=new FileReader;V.onload=J=>{h(J.target.result)},V.readAsDataURL(D)},f=()=>{P(null),h(x.image_url||null);const v=document.getElementById("edit-cover-image");v&&(v.value="")},A=["Electronics","Civil Engineering","Energy","Software","Design","Robotics","Mechanical","Chemical","Environmental"],G=[{value:"beginner",label:"ผู้เริ่มต้น"},{value:"intermediate",label:"ระดับกลาง"},{value:"advanced",label:"ระดับสูง"}],B=()=>{var v;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg border",children:[e.jsx("h1",{className:"text-3xl font-bold text-emerald-900 mb-4",children:x.title||"ชื่อคอร์ส"}),e.jsx("p",{className:"text-emerald-800 text-lg leading-relaxed mb-6",children:x.description||"คำอธิบายคอร์ส"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{className:"w-5 h-5 text-[#667eea]"}),e.jsxs("span",{className:"text-emerald-800",children:["สอนโดย: ",x.instructor_name||"ไม่ระบุ"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"w-5 h-5 text-[#667eea]"}),e.jsxs("span",{className:"text-emerald-800",children:["ระยะเวลา: ",x.duration_hours||0," ชั่วโมง"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"w-5 h-5 text-[#667eea]"}),e.jsx("span",{className:"text-emerald-800",children:"ผู้เรียน: 0 คน"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"w-5 h-5 text-[#667eea]"}),e.jsxs("span",{className:"text-emerald-800",children:["ระดับ: ",x.level==="beginner"?"ผู้เริ่มต้น":x.level==="intermediate"?"ระดับกลาง":x.level==="advanced"?"ระดับสูง":"ไม่ระบุ"]})]})]}),b&&e.jsx("img",{className:"w-full h-64 object-cover rounded-lg mb-6 shadow-md",alt:x.title,src:b})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h2",{className:"text-3xl font-bold text-emerald-900",children:["฿",((v=x.price)==null?void 0:v.toLocaleString())||"0"]}),e.jsxs("div",{className:"flex items-center",children:[[...Array(5)].map((D,F)=>e.jsx(ue,{className:"w-5 h-5 text-yellow-400 fill-current"},F)),e.jsx("span",{className:"ml-2 text-sm text-emerald-800",children:"(5.0)"})]})]}),e.jsx("p",{className:"text-sm text-emerald-700 mb-6",children:"ราคาพิเศษสำหรับนักเรียน Login Learning"}),e.jsx(E,{size:"lg",className:"w-full bg-gradient-to-r from-[#667eea] to-[#764ba2] hover:from-[#5a6fcf] hover:to-[#673f8b] text-white text-lg py-3",disabled:!0,children:"ลงทะเบียนเรียนเลย"}),e.jsx("p",{className:"text-xs text-slate-500 mt-4 text-center",children:"รับประกันความพึงพอใจ คืนเงินภายใน 7 วัน"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg border",children:[e.jsx("h3",{className:"text-xl font-semibold text-emerald-900 mb-3",children:"สิ่งที่คุณจะได้รับ"}),e.jsx("ul",{className:"space-y-2 text-emerald-800 text-sm list-disc list-inside",children:x.learning_outcomes&&x.learning_outcomes.length>0?x.learning_outcomes.filter(D=>D.trim()!=="").map((D,F)=>e.jsx("li",{children:D},F)):e.jsx("li",{className:"text-gray-400",children:"ยังไม่ได้ระบุสิ่งที่จะได้รับ"})})]}),x.tools_required&&x.tools_required.some(D=>D.trim()!=="")&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg border",children:[e.jsx("h3",{className:"text-xl font-semibold text-emerald-900 mb-3",children:"เครื่องมือที่ใช้"}),e.jsx("ul",{className:"space-y-2 text-emerald-800 text-sm list-disc list-inside",children:x.tools_required.filter(D=>D.trim()!=="").map((D,F)=>e.jsx("li",{children:D},F))})]})]})};return s?e.jsx(ge,{children:e.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:t,children:e.jsxs(R.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{type:"spring",duration:.3},className:`bg-white shadow-2xl rounded-2xl w-full ${m?"max-w-7xl":"max-w-4xl"} max-h-[90vh] overflow-hidden border border-gray-200`,onClick:v=>v.stopPropagation(),children:[e.jsx("div",{className:"bg-gradient-to-r from-emerald-600 to-teal-600 p-8 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-xl backdrop-blur-sm",children:e.jsx(ce,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-white",children:"แก้ไขคอร์ส"}),e.jsx("p",{className:"text-emerald-100 mt-1",children:"อัปเดตข้อมูลและรายละเอียดคอร์ส"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(E,{variant:"ghost",onClick:()=>S(!m),className:"text-white hover:bg-white/20 rounded-xl flex items-center space-x-2",children:[e.jsx(ae,{className:"w-5 h-5"}),e.jsx("span",{children:m?"ซ่อนตัวอย่าง":"แสดงตัวอย่าง"})]}),e.jsx(E,{variant:"ghost",size:"icon",onClick:t,disabled:o,className:"text-white hover:bg-white/20 rounded-xl",children:e.jsx(le,{className:"w-6 h-6"})})]})]})}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-120px)]",children:w?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"กำลังโหลดข้อมูลคอร์ส..."})]}):e.jsxs("div",{className:`${m?"grid grid-cols-1 lg:grid-cols-2 gap-8":"max-w-4xl mx-auto"} p-8`,children:[e.jsx("div",{className:"space-y-6",children:e.jsxs("form",{onSubmit:M,className:"space-y-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-blue-500 p-2 rounded-lg mr-3",children:e.jsx(xe,{className:"w-4 h-4 text-white"})}),"ชื่อคอร์ส *"]}),e.jsx(O,{name:"title",value:x.title,onChange:C,placeholder:"เช่น Arduino Automation Systems",className:"bg-white border-gray-300 text-gray-800 text-lg h-12 focus:border-blue-500 focus:ring-blue-500 rounded-xl shadow-sm",error:y.title}),y.title&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),y.title]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-green-500 p-2 rounded-lg mr-3",children:e.jsx(K,{className:"w-4 h-4 text-white"})}),"คำอธิบายคอร์ส *"]}),e.jsx("textarea",{name:"description",value:x.description,onChange:C,placeholder:"อธิบายเนื้อหาและสิ่งที่นักเรียนจะได้เรียนรู้...",rows:4,className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl text-gray-800 placeholder-gray-500 focus:border-green-500 focus:ring-2 focus:ring-green-200 text-base shadow-sm resize-none"}),y.description&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),y.description]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 p-6 rounded-xl border border-purple-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-4 flex items-center",children:[e.jsx("div",{className:"bg-purple-500 p-2 rounded-lg mr-3",children:e.jsx(oe,{className:"w-4 h-4 text-white"})}),"สิ่งที่จะได้รับจากคอร์ส"]}),e.jsxs("div",{className:"space-y-3",children:[x.learning_outcomes.map((v,D)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(O,{value:v,onChange:F=>q(D,F.target.value),placeholder:"เช่น ความรู้และทักษะทางวิศวกรรมที่แข็งแกร่ง",className:"bg-white border-gray-300 text-gray-800 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 rounded-xl shadow-sm"}),x.learning_outcomes.length>1&&e.jsx(E,{type:"button",variant:"ghost",size:"icon",onClick:()=>U(D),className:"text-red-500 hover:text-red-600 hover:bg-red-50 rounded-xl",children:e.jsx(Q,{className:"w-4 h-4"})})]},D)),e.jsxs(E,{type:"button",variant:"outline",onClick:n,className:"w-full border-dashed border-purple-300 text-purple-600 hover:bg-purple-50 rounded-xl",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"เพิ่มสิ่งที่ได้รับ"]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 p-6 rounded-xl border border-orange-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-4 flex items-center",children:[e.jsx("div",{className:"bg-orange-500 p-2 rounded-lg mr-3",children:e.jsx(ce,{className:"w-4 h-4 text-white"})}),"เครื่องมือที่ใช้"]}),e.jsxs("div",{className:"space-y-3",children:[x.tools_required.map((v,D)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(O,{value:v,onChange:F=>c(D,F.target.value),placeholder:"เช่น Arduino IDE, Breadboard, Jumper wires",className:"bg-white border-gray-300 text-gray-800 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 rounded-xl shadow-sm"}),x.tools_required.length>1&&e.jsx(E,{type:"button",variant:"ghost",size:"icon",onClick:()=>I(D),className:"text-red-500 hover:text-red-600 hover:bg-red-50 rounded-xl",children:e.jsx(Q,{className:"w-4 h-4"})})]},D)),e.jsxs(E,{type:"button",variant:"outline",onClick:L,className:"w-full border-dashed border-orange-300 text-orange-600 hover:bg-orange-50 rounded-xl",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"เพิ่มเครื่องมือ"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-violet-50 p-6 rounded-xl border border-purple-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-purple-500 p-2 rounded-lg mr-3",children:e.jsx(pe,{className:"w-4 h-4 text-white"})}),"หมวดหมู่ *"]}),e.jsxs("select",{name:"category",value:x.category,onChange:C,className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl text-gray-800 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 h-12 shadow-sm",children:[e.jsx("option",{value:"",children:"เลือกหมวดหมู่"}),A.map(v=>e.jsx("option",{value:v,children:v},v))]}),y.category&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),y.category]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 p-6 rounded-xl border border-amber-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-amber-500 p-2 rounded-lg mr-3",children:e.jsx(Z,{className:"w-4 h-4 text-white"})}),"ระดับความยาก"]}),e.jsx("select",{name:"level",value:x.level,onChange:C,className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-xl text-gray-800 focus:border-amber-500 focus:ring-2 focus:ring-amber-200 h-12 shadow-sm",children:G.map(v=>e.jsx("option",{value:v.value,children:v.label},v.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-cyan-50 to-blue-50 p-6 rounded-xl border border-cyan-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-cyan-500 p-2 rounded-lg mr-3",children:e.jsx(re,{className:"w-4 h-4 text-white"})}),"ระยะเวลา (ชั่วโมง) *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(O,{type:"number",name:"duration_hours",value:x.duration_hours,onChange:C,placeholder:"40",min:"0",className:"pl-12 pr-4 bg-white border-gray-300 text-gray-800 h-12 focus:border-cyan-500 focus:ring-2 focus:ring-cyan-200 rounded-xl shadow-sm text-lg"})]}),y.duration_hours&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),y.duration_hours]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-green-50 p-6 rounded-xl border border-emerald-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-emerald-500 p-2 rounded-lg mr-3",children:e.jsx(ye,{className:"w-4 h-4 text-white"})}),"ราคา (บาท)"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(O,{type:"number",name:"price",value:x.price,onChange:C,placeholder:"2500",min:"0",step:"0.01",className:"pl-12 pr-4 bg-white border-gray-300 text-gray-800 h-12 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 rounded-xl shadow-sm text-lg"})]}),y.price&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),y.price]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-blue-50 p-6 rounded-xl border border-indigo-200",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center",children:[e.jsx("div",{className:"bg-indigo-500 p-2 rounded-lg mr-3",children:e.jsx(Z,{className:"w-5 h-5 text-white"})}),"ข้อมูลอาจารย์"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"ชื่ออาจารย์ *"}),e.jsx(O,{name:"instructor_name",value:x.instructor_name,onChange:C,placeholder:"อาจารย์สมชาย",className:"bg-white border-gray-300 text-gray-800 h-12 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 rounded-xl shadow-sm"}),y.instructor_name&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),y.instructor_name]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"อีเมลอาจารย์"}),e.jsx(O,{type:"email",name:"instructor_email",value:x.instructor_email,onChange:C,placeholder:"teacher@loginlearning.com",className:"bg-white border-gray-300 text-gray-800 h-12 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 rounded-xl shadow-sm"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-rose-50 to-pink-50 p-6 rounded-xl border border-rose-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-3 flex items-center",children:[e.jsx("div",{className:"bg-rose-500 p-2 rounded-lg mr-3",children:e.jsx(Z,{className:"w-4 h-4 text-white"})}),"จำนวนนักเรียนสูงสุด *"]}),e.jsxs("div",{className:"relative max-w-xs",children:[e.jsx(Z,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(O,{type:"number",name:"max_students",value:x.max_students,onChange:C,placeholder:"50",min:"1",className:"pl-12 pr-4 bg-white border-gray-300 text-gray-800 h-12 focus:border-rose-500 focus:ring-2 focus:ring-rose-200 rounded-xl shadow-sm text-lg"})]}),y.max_students&&e.jsxs("p",{className:"text-red-600 text-sm mt-2 flex items-center bg-red-50 p-2 rounded-lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),y.max_students]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-teal-50 to-cyan-50 p-6 rounded-xl border border-teal-200",children:[e.jsxs("label",{className:"block text-gray-800 font-semibold mb-4 flex items-center",children:[e.jsx("div",{className:"bg-teal-500 p-2 rounded-lg mr-3",children:e.jsx(Y,{className:"w-4 h-4 text-white"})}),"รูปหน้าปกคอร์ส"]}),e.jsxs("div",{className:"space-y-4",children:[b&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:b,alt:"Course cover preview",className:"w-48 h-32 object-cover rounded-xl border-2 border-gray-200 shadow-lg"}),e.jsx(E,{type:"button",variant:"ghost",size:"icon",onClick:f,className:"absolute -top-2 -right-2 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full shadow-lg",children:e.jsx(Q,{className:"w-4 h-4"})})]}),!b&&e.jsxs("div",{className:"border-2 border-dashed border-teal-300 rounded-xl p-8 text-center hover:border-teal-400 transition-colors bg-white/50",children:[e.jsx("input",{type:"file",id:"edit-cover-image",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:z,className:"hidden",disabled:T}),e.jsxs("label",{htmlFor:"edit-cover-image",className:"cursor-pointer flex flex-col items-center space-y-3",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-teal-400 to-cyan-500 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(Y,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-800 font-semibold text-lg",children:"เลือกรูปหน้าปก"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"JPG, PNG, WebP ขนาดไม่เกิน 5MB"}),e.jsx("p",{className:"text-teal-600 text-xs mt-2 font-medium",children:"คลิกเพื่ออัปโหลดไฟล์"})]})]})]}),b&&!k&&e.jsxs("div",{className:"text-center",children:[e.jsx("input",{type:"file",id:"edit-cover-image",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:z,className:"hidden",disabled:T}),e.jsxs("label",{htmlFor:"edit-cover-image",className:"cursor-pointer inline-flex items-center px-4 py-2 border border-teal-300 text-teal-700 bg-white hover:bg-teal-50 rounded-lg font-medium transition-colors",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"เปลี่ยนรูปภาพ"]})]}),T&&e.jsxs("div",{className:"flex items-center justify-center space-x-3 bg-blue-50 p-4 rounded-xl",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-blue-700 font-medium",children:"กำลังอัปโหลดรูปภาพ..."})]})]})]}),e.jsxs("div",{className:"flex justify-center space-x-4 pt-8",children:[e.jsx(E,{type:"button",variant:"outline",onClick:t,disabled:o,className:"px-8 py-3 text-gray-600 border-gray-300 hover:bg-gray-50 rounded-xl font-medium text-lg h-14 min-w-[120px]",children:"ยกเลิก"}),e.jsx(E,{type:"submit",disabled:o||T,className:"px-12 py-3 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white rounded-xl font-semibold text-lg h-14 min-w-[160px] shadow-lg hover:shadow-xl transition-all duration-200",children:o||T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"}),T?"กำลังอัปโหลดรูป...":"กำลังอัปเดต..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-5 h-5 mr-3"}),"อัปเดตคอร์ส"]})})]})]})}),m&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky top-0 bg-white z-10 pb-4",children:[e.jsxs("h3",{className:"text-2xl font-bold text-emerald-900 flex items-center",children:[e.jsx(ae,{className:"w-6 h-6 mr-3"}),"ตัวอย่างหน้าคอร์ส"]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"ดูการเปลี่ยนแปลงแบบ Real-time"})]}),e.jsx("div",{className:"bg-gradient-to-br from-emerald-50 to-teal-50 p-6 rounded-xl border-2 border-emerald-200 max-h-[calc(90vh-300px)] overflow-y-auto",children:e.jsx(B,{})})]})]})})]})})}):null},gs=()=>{const{toast:s}=Ae(),t=Ce(),[r,a]=g.useState(""),[l,o]=g.useState([]),[i,w]=g.useState(!0),[u,x]=g.useState(null),[_,y]=g.useState(!1),[p,k]=g.useState(!1),[P,T]=g.useState(null),j=c=>{if(!c)return"ไม่มีคำอธิบาย";const $=c.split(`
`);return $.length>1?`${$[0]}...`:$[0]},b=g.useCallback(async()=>{w(!0);const{data:c,error:$}=await Ft();$?s({title:"ข้อผิดพลาดในการโหลดข้อมูล",description:$.message,variant:"destructive"}):o(c||[]),w(!1)},[s]),h=g.useCallback(async()=>{const{data:c,error:$}=await Ot();!$&&c&&x(c)},[]);g.useEffect(()=>{b(),h()},[b,h]);const m=async(c,$,M)=>{const z=!M,f=z?"เปิดใช้งาน":"ปิดใช้งาน";if(!confirm(`คุณแน่ใจหรือไม่ที่จะ${f}คอร์ส "${$}"?`))return;const{error:A}=await Rt(c,z);A?s({title:`ไม่สามารถ${f}คอร์สได้`,description:A.message,variant:"destructive"}):(s({title:`${f}คอร์สสำเร็จ`,description:`คอร์ส "${$}" ถูก${f}แล้ว`}),b(),h())},S=async(c,$,M)=>{const z=!M,f=z?"เพิ่มเป็นคอร์สแนะนำ":"ยกเลิกคอร์สแนะนำ",{error:A}=await Mt(c,z);A?s({title:`ไม่สามารถ${f}ได้`,description:A.message,variant:"destructive"}):(s({title:`${f}สำเร็จ`,description:`คอร์ส "${$}" ถูก${f}แล้ว`}),b(),h())},N=()=>{b(),h()},C=()=>{b(),h()},n=c=>{T(c),k(!0)},U=()=>{k(!1),T(null)},q=c=>{s({title:"ฟีเจอร์ยังไม่พร้อมใช้งาน",description:`${c} ยังอยู่ในระหว่างการพัฒนา`,variant:"info"})},L=l.filter(c=>c.title.toLowerCase().includes(r.toLowerCase())||c.category.toLowerCase().includes(r.toLowerCase())),I={initial:{opacity:0,y:20},in:{opacity:1,y:0},out:{opacity:0,y:-20}};return e.jsxs(R.div,{initial:"initial",animate:"in",exit:"out",variants:I,className:"container mx-auto px-4 py-12",children:[e.jsxs(he,{children:[e.jsx("title",{children:"จัดการคอร์สเรียน - ผู้ดูแลระบบ Login Learning"}),e.jsx("meta",{name:"description",content:"จัดการคอร์สเรียนทั้งหมดในระบบ Login Learning"})]}),e.jsxs(R.div,{initial:{y:-30,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,delay:.1},className:"flex flex-col sm:flex-row justify-between items-center mb-10",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(E,{variant:"ghost",size:"sm",onClick:()=>t("/admin"),className:"mr-4 text-gray-600 hover:text-gray-900",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"ย้อนกลับ"]}),e.jsxs("h1",{className:"text-3xl lg:text-4xl font-bold text-purple-900 mb-4 sm:mb-0",children:[e.jsx(ie,{className:"inline-block w-8 h-8 mr-3 text-[#667eea]"}),"จัดการคอร์สเรียน"]})]}),e.jsxs(E,{onClick:()=>y(!0),className:"bg-gradient-to-r from-[#667eea] to-[#764ba2] hover:from-[#5a6fcf] hover:to-[#673f8b] text-white-800",children:[e.jsx(we,{className:"w-5 h-5 mr-2"}),"เพิ่มคอร์สใหม่"]})]}),u&&e.jsxs(R.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,delay:.2},className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"glass-effect p-6 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-700 text-sm",children:"คอร์สทั้งหมด"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:u.totalCourses})]}),e.jsx(ie,{className:"w-8 h-8 text-[#667eea]"})]})}),e.jsx("div",{className:"glass-effect p-6 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-700 text-sm",children:"นักเรียนทั้งหมด"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:u.totalEnrollments})]}),e.jsx(Z,{className:"w-8 h-8 text-green-400"})]})}),e.jsx("div",{className:"glass-effect p-6 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-700 text-sm",children:"กำลังเรียน"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:u.activeEnrollments})]}),e.jsx(ve,{className:"w-8 h-8 text-blue-400"})]})}),e.jsx("div",{className:"glass-effect p-6 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-700 text-sm",children:"อัตราสำเร็จ"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:[u.completionRate,"%"]})]}),e.jsx(ae,{className:"w-8 h-8 text-purple-400"})]})})]}),e.jsx("div",{className:"mb-6 glass-effect p-4 rounded-xl",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(O,{type:"text",placeholder:"ค้นหาคอร์ส (ชื่อ, หมวดหมู่)...",value:r,onChange:c=>a(c.target.value),className:"pl-10 w-full bg-slate-200 border-slate-400 text-gray-900 focus:border-[#667eea]"})]})}),e.jsxs("div",{className:"glass-effect rounded-xl shadow-xl overflow-x-auto",children:[i?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#667eea] mx-auto mb-4"}),e.jsx("p",{className:"text-purple-700",children:"กำลังโหลดข้อมูลคอร์ส..."})]}):e.jsxs("table",{className:"w-full min-w-max text-left text-purple-800",children:[e.jsx("thead",{className:"border-b border-slate-700",children:e.jsxs("tr",{className:"bg-purple-100/30",children:[e.jsx("th",{className:"p-4",children:"ชื่อคอร์ส"}),e.jsx("th",{className:"p-4",children:"หมวดหมู่"}),e.jsx("th",{className:"p-4",children:"นักเรียน"}),e.jsx("th",{className:"p-4",children:"ระยะเวลา"}),e.jsx("th",{className:"p-4",children:"ราคา"}),e.jsx("th",{className:"p-4",children:"สถานะ"}),e.jsx("th",{className:"p-4",children:"แนะนำ"}),e.jsx("th",{className:"p-4",children:"วันที่สร้าง"}),e.jsx("th",{className:"p-4 text-center",children:"การดำเนินการ"})]})}),e.jsx("tbody",{children:L.map((c,$)=>e.jsxs(R.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:$*.05},className:"border-b border-slate-700/50 hover:bg-slate-700/20 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-purple-900",children:c.title}),e.jsx("p",{className:"text-sm text-purple-700 truncate max-w-xs",children:j(c.description)})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-500/30 text-blue-300",children:c.category||"ไม่ระบุ"})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{className:"w-4 h-4 mr-1 text-purple-700"}),c.enrollment_count||0]})}),e.jsxs("td",{className:"p-4",children:[c.duration_hours||0," ชั่วโมง"]}),e.jsx("td",{className:"p-4",children:c.price?`฿${c.price.toLocaleString()}`:"ฟรี"}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${c.is_active?"bg-green-500/30 text-green-300":"bg-red-500/30 text-red-300"}`,children:c.is_active?"เปิดใช้งาน":"ปิดใช้งาน"})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:`w-4 h-4 mr-1 ${c.is_featured?"text-yellow-400 fill-current":"text-gray-400"}`}),e.jsx("span",{className:`text-xs ${c.is_featured?"text-yellow-400":"text-gray-500"}`,children:c.is_featured?"แนะนำ":"ทั่วไป"})]})}),e.jsx("td",{className:"p-4",children:new Date(c.created_at).toLocaleDateString("th-TH")}),e.jsxs("td",{className:"p-4 text-center space-x-2",children:[e.jsx(te,{to:`/admin/courses/${c.id}/content`,children:e.jsx(E,{variant:"ghost",size:"icon",className:"text-green-400 hover:bg-green-500/20",title:"จัดการเนื้อหา",children:e.jsx(K,{className:"w-4 h-4"})})}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>n(c.id),className:"text-blue-400 hover:bg-blue-500/20",title:"แก้ไขคอร์ส",children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>S(c.id,c.title,c.is_featured),className:c.is_featured?"text-yellow-400 hover:bg-yellow-500/20":"text-gray-400 hover:bg-gray-500/20",title:c.is_featured?"ยกเลิกคอร์สแนะนำ":"ตั้งเป็นคอร์สแนะนำ",children:e.jsx(ue,{className:`w-4 h-4 ${c.is_featured?"fill-current":""}`})}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>m(c.id,c.title,c.is_active),className:c.is_active?"text-orange-400 hover:bg-orange-500/20":"text-green-400 hover:bg-green-500/20",title:c.is_active?"ปิดใช้งาน":"เปิดใช้งาน",children:c.is_active?e.jsx(at,{className:"w-4 h-4"}):e.jsx(lt,{className:"w-4 h-4"})}),!c.is_active&&e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>q(`ลบถาวรคอร์ส ${c.title}`),className:"text-red-400 hover:bg-red-500/20",title:"ลบถาวร",children:e.jsx(Q,{className:"w-4 h-4"})})]})]},c.id))})]}),!i&&L.length===0&&e.jsxs("div",{className:"text-center p-8",children:[e.jsx(be,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),e.jsx("p",{className:"text-purple-700 text-lg",children:"ไม่พบคอร์สเรียนที่ตรงกับการค้นหา"}),e.jsx("p",{className:"text-purple-600 text-sm mt-2",children:"ลองปรับเปลี่ยนคำค้นหาหรือเพิ่มคอร์สใหม่"})]})]}),e.jsx(xs,{isOpen:_,onClose:()=>y(!1),onSuccess:N}),e.jsx(hs,{isOpen:p,onClose:U,onSuccess:C,courseId:P})]})},Xs=Object.freeze(Object.defineProperty({__proto__:null,default:gs},Symbol.toStringTag,{value:"Module"})),ps=async s=>{try{const{data:{user:t},error:r}=await d.auth.getUser();if(r||!t)throw new Error("User not authenticated");const{data:a,error:l}=await d.from("course_content").insert([{...s}]).select().single();if(l)throw l;return{data:a,error:null}}catch(t){return console.error("Error creating content:",t),{data:null,error:t}}},fs=async(s,t)=>{try{const{data:{user:r},error:a}=await d.auth.getUser();if(a||!r)throw new Error("User not authenticated");const{data:l,error:o}=await d.from("course_content").update({...t}).eq("id",s).select().single();if(o)throw o;return{data:l,error:null}}catch(r){return console.error("Error updating content:",r),{data:null,error:r}}},bs=async s=>{try{const{data:{user:t},error:r}=await d.auth.getUser();if(r||!t)throw new Error("User not authenticated");const{data:a}=await d.from("quizzes").select("id").eq("content_id",s),{data:l}=await d.from("assignments").select("id").eq("content_id",s);if(a&&a.length>0){for(const i of a)await d.from("quiz_attempts").delete().eq("quiz_id",i.id);await d.from("quizzes").delete().eq("content_id",s)}if(l&&l.length>0){for(const i of l)await d.from("assignment_submissions").delete().eq("assignment_id",i.id);await d.from("assignments").delete().eq("content_id",s)}await d.from("video_progress").delete().eq("content_id",s);const{error:o}=await d.from("course_content").delete().eq("id",s);if(o)throw o;return{error:null}}catch(t){return console.error("Error deleting content:",t),{error:t}}},js=async(s,t)=>{try{const{data:{user:r},error:a}=await d.auth.getUser();if(a||!r)throw new Error("User not authenticated");const l=t.map((w,u)=>d.from("course_content").update({order_index:u+1,updated_at:new Date().toISOString()}).eq("id",w.id)),i=(await Promise.all(l)).filter(w=>w.error);if(i.length>0)throw i[0].error;return{error:null}}catch(r){return console.error("Error reordering content:",r),{error:r}}},vs=({contentId:s,existingFiles:t=[],onFilesChange:r,maxFiles:a=10,maxFileSize:l=50*1024*1024,allowedTypes:o=["pdf","doc","docx","ppt","pptx","xls","xlsx","jpg","jpeg","png","gif","mp4","mp3","zip","rar","txt"],uploadMode:i="admin",className:w=""})=>{const{toast:u}=ee(),x=g.useRef(null),[_,y]=g.useState(t),[p,k]=g.useState(!1),[P,T]=g.useState(!1),j=c=>{const $=c==null?void 0:c.toLowerCase();return["jpg","jpeg","png","gif","webp","svg"].includes($)?e.jsx(Y,{className:"w-5 h-5 text-blue-500"}):["mp4","avi","mov","wmv","flv"].includes($)?e.jsx(Fe,{className:"w-5 h-5 text-purple-500"}):["zip","rar","7z","tar","gz"].includes($)?e.jsx(nt,{className:"w-5 h-5 text-orange-500"}):["pdf"].includes($)?e.jsx(K,{className:"w-5 h-5 text-red-500"}):["doc","docx"].includes($)?e.jsx(K,{className:"w-5 h-5 text-blue-600"}):["ppt","pptx"].includes($)?e.jsx(K,{className:"w-5 h-5 text-orange-600"}):["xls","xlsx"].includes($)?e.jsx(K,{className:"w-5 h-5 text-green-600"}):e.jsx(it,{className:"w-5 h-5 text-slate-500"})},b=c=>{if(c===0)return"0 Bytes";const $=1024,M=["Bytes","KB","MB","GB"],z=Math.floor(Math.log(c)/Math.log($));return parseFloat((c/Math.pow($,z)).toFixed(2))+" "+M[z]},h=c=>{var z;const $=[];c.size>l&&$.push(`ไฟล์ ${c.name} มีขนาดใหญ่เกินกำหนด (${b(l)})`);const M=(z=c.name.split(".").pop())==null?void 0:z.toLowerCase();return o.includes(M)||$.push(`ไฟล์ ${c.name} ไม่ใช่ประเภทที่อนุญาต`),{isValid:$.length===0,errors:$}},m=c=>{if(!c||c.length===0)return;const $=Array.from(c);if(_.length+$.length>a){u({title:"จำนวนไฟล์เกินกำหนด",description:`สามารถอัปโหลดได้สูงสุด ${a} ไฟล์`,variant:"destructive"});return}const M=[],z=[];if($.forEach(f=>{var G;const A=h(f);if(A.isValid){const B=`file_${Date.now()}_${Math.floor(Math.random()*1e3)}`;M.push({id:B,file:f,name:f.name,size:f.size,type:(G=f.name.split(".").pop())==null?void 0:G.toLowerCase(),mimeType:f.type,isUploading:!1,isUploaded:!1,progress:0,url:null,path:null})}else z.push(...A.errors)}),z.length>0&&u({title:"ไฟล์บางไฟล์ไม่ถูกต้อง",description:z.join(`
`),variant:"destructive"}),M.length>0){const f=[..._,...M];y(f),r==null||r(f)}},S=c=>{c.preventDefault(),T(!1),m(c.dataTransfer.files)},N=c=>{c.preventDefault(),c.stopPropagation(),c.type==="dragenter"||c.type==="dragover"?T(!0):c.type==="dragleave"&&T(!1)},C=c=>{const $=_.filter(M=>M.id!==c);y($),r==null||r($)},n=async(c,$=1)=>{var M;y(z=>z.map(f=>f.id===c.id?{...f,isUploading:!0,progress:0}:f));try{const z=setInterval(()=>{y(G=>G.map(B=>B.id===c.id?{...B,progress:Math.min(B.progress+10,90)}:B))},200),{data:f,error:A}=await Bt(c.file,s,$);if(clearInterval(z),A)throw A;return y(G=>G.map(B=>B.id===c.id?{...B,isUploading:!1,isUploaded:!0,progress:100,url:f.url,path:f.file_path,attachmentId:f.id}:B)),{success:!0,data:f}}catch(z){console.error("Upload error details:",z);const f=((M=z==null?void 0:z.error)==null?void 0:M.message)||(z==null?void 0:z.message)||"ไม่สามารถอัปโหลดไฟล์ได้";throw y(A=>A.map(G=>G.id===c.id?{...G,isUploading:!1,isUploaded:!1,progress:0,error:f}:G)),u({title:"ไม่สามารถอัปโหลดไฟล์ได้",description:f,variant:"destructive"}),z}},U=async()=>{if(!s){u({title:"ไม่สามารถอัปโหลดได้",description:"กรุณาบันทึกเนื้อหาก่อนเพื่อให้ได้ Content ID",variant:"destructive"});return}k(!0);const c=_.filter($=>!$.isUploaded&&!$.isUploading);if(c.length===0){u({title:"ไม่มีไฟล์ที่ต้องอัปโหลด",description:"ไฟล์ทั้งหมดถูกอัปโหลดแล้ว"}),k(!1);return}try{const $=await Promise.allSettled(c.map((f,A)=>n(f,A+1))),M=$.filter(f=>f.status==="fulfilled").length,z=$.filter(f=>f.status==="rejected").length;M>0&&z===0?u({title:"อัปโหลดสำเร็จ ✅",description:`อัปโหลดไฟล์ ${M} ไฟล์เสร็จสิ้น`}):M>0&&z>0?u({title:"อัปโหลดเสร็จบางส่วน",description:`สำเร็จ ${M} ไฟล์, ล้มเหลว ${z} ไฟล์`,variant:"destructive"}):u({title:"อัปโหลดล้มเหลว",description:"ไม่สามารถอัปโหลดไฟล์ใดๆ ได้",variant:"destructive"}),r==null||r(_)}catch{u({title:"เกิดข้อผิดพลาด",description:"ไม่สามารถอัปโหลดไฟล์ได้",variant:"destructive"})}finally{k(!1)}},q=c=>{if(c.url){const $=document.createElement("a");$.href=c.url,$.download=c.name,document.body.appendChild($),$.click(),document.body.removeChild($)}},L=_.filter(c=>!c.isUploaded),I=_.filter(c=>c.isUploaded);return e.jsxs("div",{className:`space-y-4 ${w}`,children:[e.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-6 transition-colors ${P?"border-blue-500 bg-blue-500/10":"border-slate-600 hover:border-slate-500"}`,onDragEnter:N,onDragLeave:N,onDragOver:N,onDrop:S,children:[e.jsx("input",{ref:x,type:"file",multiple:!0,accept:o.map(c=>`.${c}`).join(","),onChange:c=>m(c.target.files),className:"hidden"}),e.jsxs("div",{className:"text-center",children:[e.jsx(Ne,{className:"w-8 h-8 text-slate-400 mx-auto mb-3"}),e.jsxs("p",{className:"text-slate-300 mb-2",children:["ลากไฟล์มาวางที่นี่ หรือ"," ",e.jsx("button",{type:"button",onClick:()=>{var c;return(c=x.current)==null?void 0:c.click()},className:"text-blue-400 hover:text-blue-300 underline",children:"เลือกไฟล์"})]}),e.jsxs("p",{className:"text-xs text-slate-500",children:["ไฟล์ที่รองรับ: ",o.join(", ")," | ขนาดสูงสุด: ",b(l)," | จำนวนสูงสุด: ",a," ไฟล์"]})]})]}),_.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300",children:["ไฟล์ที่เลือก (",_.length,"/",a,")"]}),L.length>0&&e.jsx(E,{size:"sm",onClick:U,disabled:p,className:"bg-blue-500 hover:bg-blue-600",children:p?e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"w-4 h-4 mr-2 animate-spin"}),"กำลังอัปโหลด..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"อัปโหลดทั้งหมด"]})})]}),e.jsx("div",{className:"grid gap-2",children:e.jsx(ge,{children:_.map(c=>e.jsxs(R.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex items-center space-x-3 p-3 bg-slate-700/30 rounded-lg border border-slate-600",children:[e.jsx("div",{className:"flex-shrink-0",children:j(c.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:c.name}),c.isUploaded&&e.jsx(Se,{className:"w-4 h-4 text-green-400"})]}),e.jsx("p",{className:"text-xs text-slate-400",children:b(c.size)}),c.isUploading&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"w-full bg-slate-600 rounded-full h-1",children:e.jsx("div",{className:"bg-blue-500 h-1 rounded-full transition-all duration-300",style:{width:`${c.progress}%`}})}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:[c.progress,"%"]})]}),c.error&&e.jsx("div",{className:"mt-2 p-2 bg-red-500/20 border border-red-500/30 rounded text-xs",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(W,{className:"w-3 h-3 text-red-400 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-red-400",children:c.error})})]})})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[c.isUploaded&&e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>q(c),title:"ดาวน์โหลด",children:e.jsx(_e,{className:"w-4 h-4"})}),c.type&&["jpg","jpeg","png","gif","pdf"].includes(c.type)&&e.jsx(E,{size:"sm",variant:"ghost",title:"ดูตัวอย่าง",children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>C(c.id),className:"text-red-400 hover:text-red-300",title:"ลบ",children:e.jsx(Q,{className:"w-4 h-4"})})]})]},c.id))})})]}),_.length>0&&e.jsxs("div",{className:"text-xs text-slate-500 text-center",children:[I.length>0&&e.jsxs("span",{className:"text-green-400",children:["อัปโหลดแล้ว ",I.length," ไฟล์"]}),L.length>0&&I.length>0&&e.jsx("span",{className:"mx-2",children:"•"}),L.length>0&&e.jsxs("span",{className:"text-yellow-400",children:["รออัปโหลด ",L.length," ไฟล์"]})]})]})},ws=({mode:s,content:t,onSave:r,onClose:a})=>{const{toast:l}=ee(),[o,i]=g.useState({title:(t==null?void 0:t.title)||"",content_type:(t==null?void 0:t.content_type)||"video",content:(t==null?void 0:t.content)||"",video_url:(t==null?void 0:t.video_url)||"",duration_minutes:(t==null?void 0:t.duration_minutes)||0,order_index:(t==null?void 0:t.order_index)||0,is_preview:(t==null?void 0:t.is_preview)||!1,completion_requirement:(t==null?void 0:t.completion_requirement)||"full_watch",min_watch_time:(t==null?void 0:t.min_watch_time)||60,allow_manual_completion:(t==null?void 0:t.allow_manual_completion)!==!1,requires_previous_completion:(t==null?void 0:t.requires_previous_completion)!==!1,lock_enabled:(t==null?void 0:t.lock_enabled)!==!1,lock_message:(t==null?void 0:t.lock_message)||"คุณต้องทำเนื้อหาก่อนหน้าให้เสร็จก่อน"}),[w,u]=g.useState(!1),[x,_]=g.useState([]),[y,p]=g.useState((t==null?void 0:t.id)||null),[k,P]=g.useState(!1),T=[{value:"video",label:"วิดีโอ",icon:Fe,color:"blue"},{value:"lesson",label:"บทเรียน",icon:xe,color:"green"},{value:"document",label:"เอกสาร",icon:ke,color:"orange"},{value:"quiz",label:"แบบทดสอบ",icon:K,color:"yellow"},{value:"assignment",label:"การบ้าน",icon:K,color:"purple"}];g.useEffect(()=>{(async()=>{if(y){P(!0);try{console.log("Loading attachments for content:",y);const{data:m,error:S}=await Gt(y);if(S){console.error("Error loading attachments:",S),l({title:"ไม่สามารถโหลดไฟล์แนบได้",description:"มีข้อผิดพลาดในการโหลดไฟล์แนบที่มีอยู่",variant:"destructive"});return}console.log("Loaded attachments:",m);const N=m.map(C=>({id:C.id,name:C.original_filename||C.filename,size:C.file_size,type:C.file_extension,mimeType:C.mime_type,isUploading:!1,isUploaded:!0,progress:100,url:C.file_url,path:C.file_path,attachmentId:C.id}));_(N),console.log("Set attached files:",N)}catch(m){console.error("Error in loadAttachments:",m)}finally{P(!1)}}})()},[y,l]);const j=async h=>{if(h.preventDefault(),!o.title.trim()){l({title:"ข้อมูลไม่ครบถ้วน",description:"กรุณากรอกชื่อเนื้อหา",variant:"destructive"});return}u(!0);try{const m=await r(o);s==="create"&&(m!=null&&m.id)&&p(m.id);let S=`${s==="create"?"สร้าง":"แก้ไข"}เนื้อหาเรียบร้อยแล้ว`;if((o.lock_enabled||o.requires_previous_completion)&&(S+=`
🔒 การตั้งค่าล็อคเนื้อหาได้รับการบันทึกแล้ว`),l({title:"บันทึกสำเร็จ",description:S}),s==="create"&&(m!=null&&m.id)&&x.length>0){l({title:"สามารถอัปโหลดไฟล์แล้ว",description:"คุณสามารถอัปโหลดไฟล์แนบได้แล้ว"});return}a()}catch(m){console.error("Error saving content:",m),l({title:"เกิดข้อผิดพลาด",description:m.message||"ไม่สามารถบันทึกข้อมูลได้",variant:"destructive"})}finally{u(!1)}},b=(h,m)=>{i(S=>({...S,[h]:m}))};return e.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:a,children:e.jsxs(R.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:h=>h.stopPropagation(),children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 p-6 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-lg",children:e.jsx(xe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:s==="create"?"สร้างเนื้อหาใหม่":"แก้ไขเนื้อหา"}),e.jsx("p",{className:"text-indigo-100 mt-1",children:"จัดการเนื้อหาในคอร์ส"})]})]}),e.jsx(E,{variant:"ghost",size:"icon",onClick:a,className:"text-white hover:bg-white/20 rounded-lg",children:e.jsx(le,{className:"w-6 h-6"})})]})}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-800 mb-3",children:"ชื่อเนื้อหา *"}),e.jsx("input",{type:"text",value:o.title,onChange:h=>b("title",h.target.value),className:"w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-lg",placeholder:"เช่น การใช้ React Hooks",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-800 mb-3",children:"ประเภทเนื้อหา"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:T.map(h=>{const m=h.icon,S=o.content_type===h.value;return e.jsxs("button",{type:"button",onClick:()=>b("content_type",h.value),className:`p-3 rounded-lg border-2 transition-all ${S?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 bg-white hover:border-gray-300 text-gray-600"}`,children:[e.jsx(m,{className:`w-5 h-5 mx-auto mb-1 ${S?"text-indigo-600":"text-gray-500"}`}),e.jsx("div",{className:"text-sm font-medium",children:h.label})]},h.value)})})]}),o.content_type==="video"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-800 mb-3",children:"URL วิดีโอ"}),e.jsx("input",{type:"url",value:o.video_url,onChange:h=>b("video_url",h.target.value),className:"w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"https://www.youtube.com/watch?v=..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-gray-800 mb-3",children:"เนื้อหา"}),e.jsx("textarea",{value:o.content,onChange:h=>b("content",h.target.value),className:"w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none",rows:6,placeholder:"เขียนเนื้อหาบทเรียน หรือคำอธิบายเพิ่มเติม..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ระยะเวลา (นาที)"}),e.jsx("input",{type:"number",value:o.duration_minutes,onChange:h=>b("duration_minutes",parseInt(h.target.value)||0),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",min:"0",placeholder:"15"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ลำดับที่"}),e.jsx("input",{type:"number",value:o.order_index,onChange:h=>b("order_index",parseInt(h.target.value)||0),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",min:"0",placeholder:"1"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"is_preview",checked:o.is_preview,onChange:h=>b("is_preview",h.target.checked),className:"w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"is_preview",className:"text-sm font-medium text-gray-700",children:"เปิดให้ดูฟรี"})]})})]}),["document","assignment","lesson"].includes(o.content_type)&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx(ke,{className:"w-5 h-5 mr-2 text-orange-500"}),"ไฟล์แนบเอกสาร"]}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4",children:e.jsxs("p",{className:"text-sm text-orange-800",children:["💡 ",e.jsx("strong",{children:"การแนบไฟล์:"}),!y&&e.jsxs("span",{className:"text-orange-600",children:[" ","กรุณาบันทึกเนื้อหาก่อน จึงจะสามารถอัปโหลดไฟล์ได้"]}),y&&!k&&e.jsxs("span",{className:"text-green-600",children:[" ","สามารถอัปโหลดไฟล์เอกสารประกอบการเรียนได้แล้ว",x.filter(h=>h.isUploaded).length>0&&e.jsxs("span",{className:"ml-2",children:["(",x.filter(h=>h.isUploaded).length," ไฟล์)"]})]}),k&&e.jsxs("span",{className:"text-blue-600",children:[" ","กำลังโหลดไฟล์แนบ..."]})]})}),e.jsx(vs,{contentId:y,existingFiles:x,onFilesChange:_,maxFiles:5,maxFileSize:25*1024*1024,allowedTypes:["pdf","doc","docx","ppt","pptx","xls","xlsx","txt","jpg","jpeg","png","gif"],uploadMode:"admin",className:"bg-white"})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"การล็อคเนื้อหา"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"lock_enabled",checked:o.lock_enabled,onChange:h=>b("lock_enabled",h.target.checked),className:"w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"lock_enabled",className:"text-sm font-medium text-gray-700",children:"เปิดใช้งานระบบล็อคเนื้อหา"})]}),o.lock_enabled&&e.jsxs("div",{className:"ml-7 space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"requires_previous_completion",checked:o.requires_previous_completion,onChange:h=>b("requires_previous_completion",h.target.checked),className:"w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"requires_previous_completion",className:"text-sm font-medium text-gray-700",children:"ต้องทำเนื้อหาก่อนหน้าให้เสร็จก่อน"})]}),o.requires_previous_completion&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ข้อความเมื่อเนื้อหาถูกล็อค"}),e.jsx("textarea",{value:o.lock_message,onChange:h=>b("lock_message",h.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none",rows:2,placeholder:"คุณต้องทำเนื้อหาก่อนหน้าให้เสร็จก่อน"})]})]}),e.jsxs("div",{className:"bg-yellow-50 p-3 rounded-lg",children:[e.jsxs("p",{className:"text-xs text-yellow-800",children:["💡 ",e.jsx("strong",{children:"คำแนะนำ:"}),!o.lock_enabled&&" ระบบล็อคถูกปิด - ผู้เรียนสามารถเข้าถึงเนื้อหานี้ได้ทันที",o.lock_enabled&&!o.requires_previous_completion&&" ระบบล็อคเปิด แต่ไม่ต้องรอเนื้อหาก่อนหน้า",o.lock_enabled&&o.requires_previous_completion&&" ผู้เรียนต้องทำเนื้อหาก่อนหน้าให้เสร็จก่อนจึงจะเข้าถึงได้"]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-2",children:["💡 ",e.jsx("strong",{children:"หมายเหตุ:"})," รันคำสั่ง SQL ใน add-lock-columns.sql เพื่อเพิ่มคอลัมน์ในฐานข้อมูลก่อนใช้งานฟีเจอร์นี้"]})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"เงื่อนไขการผ่านเนื้อหา"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"เงื่อนไขการผ่าน"}),e.jsxs("select",{value:o.completion_requirement,onChange:h=>b("completion_requirement",h.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[e.jsx("option",{value:"manual_only",children:"ให้ผู้เรียนกดผ่านเอง"}),e.jsx("option",{value:"full_watch",children:"ดูวิดีโอให้ครบ 90%"}),e.jsx("option",{value:"time_based",children:"ดูวิดีโอครบตามเวลาที่กำหนด"}),e.jsx("option",{value:"end_reach",children:"เลื่อนไปจุดสิ้นสุดของเนื้อหา (95%)"}),e.jsx("option",{value:"any_watch",children:"ดูวิดีโอแค่บางส่วน (10%)"})]})]}),o.completion_requirement==="time_based"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"เวลาขั้นต่ำที่ต้องดู (วินาที)"}),e.jsx("input",{type:"number",value:o.min_watch_time,onChange:h=>b("min_watch_time",parseInt(h.target.value)||0),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",min:"0",placeholder:"60"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"ระบุเป็นวินาที เช่น 120 = 2 นาที"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"allow_manual_completion",checked:o.allow_manual_completion,onChange:h=>b("allow_manual_completion",h.target.checked),className:"w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500"}),e.jsx("label",{htmlFor:"allow_manual_completion",className:"text-sm font-medium text-gray-700",children:'อนุญาตให้ผู้เรียนกดผ่านเองได้ (แสดงปุ่ม "ทำเครื่องหมายว่าเสร็จแล้ว")'})]}),e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-800",children:["💡 ",e.jsx("strong",{children:"คำแนะนำ:"}),o.completion_requirement==="manual_only"&&" ผู้เรียนต้องกดปุ่มเพื่อผ่านเนื้อหานี้",o.completion_requirement==="full_watch"&&" ผู้เรียนต้องดูวิดีโอให้ครบ 90% จึงจะผ่านอัตโนมัติ",o.completion_requirement==="time_based"&&" ผู้เรียนต้องดูวิดีโอตามเวลาที่กำหนดจึงจะผ่านอัตโนมัติ",o.completion_requirement==="end_reach"&&" ผู้เรียนต้องเลื่อนวิดีโอไปใกล้จบ (95%) จึงจะผ่านอัตโนมัติ",o.completion_requirement==="any_watch"&&" ผู้เรียนดูวิดีโอแค่ 10% ก็จะผ่านอัตโนมัติ"]})})]})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx("div",{className:"flex space-x-3",children:e.jsx(E,{type:"button",variant:"outline",onClick:a,disabled:w,children:"ยกเลิก"})}),e.jsxs("div",{className:"flex space-x-3",children:[x.length>0&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mr-4",children:[e.jsx(ke,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:[x.filter(h=>h.isUploaded).length,"/",x.length," ไฟล์"]})]}),e.jsxs(E,{type:"submit",disabled:w,className:"bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),w?"กำลังบันทึก...":y?"บันทึกการเปลี่ยนแปลง":"บันทึกเนื้อหา"]}),y&&x.some(h=>h.isUploaded)&&e.jsx(E,{type:"button",variant:"outline",onClick:a,className:"border-green-500 text-green-600 hover:bg-green-50",children:"เสร็จสิ้น"})]})]})]})]})})},Ns=({content:s,index:t,moveContent:r,onEdit:a,onDelete:l,onTogglePreview:o,onDragEnd:i})=>{const[{isDragging:w},u]=mt({type:"content",item:{id:s.id,index:t},end:()=>{i&&i()},collect:p=>({isDragging:p.isDragging()})}),[,x]=ut({accept:"content",hover:p=>{p.index!==t&&(r(p.index,t),p.index=t)}}),_=p=>{switch(p){case"lesson":return e.jsx(ft,{className:"w-5 h-5 text-blue-500"});case"quiz":return e.jsx(pt,{className:"w-5 h-5 text-green-500"});case"assignment":return e.jsx(gt,{className:"w-5 h-5 text-purple-500"});default:return e.jsx(K,{className:"w-5 h-5 text-gray-500"})}},y=p=>{switch(p){case"lesson":return"lesson";case"quiz":return"quiz";case"assignment":return"assignment";default:return"content"}};return e.jsx(R.div,{ref:p=>u(x(p)),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},className:`glass-effect p-4 rounded-xl cursor-move ${w?"opacity-50 scale-95":""} hover:shadow-lg transition-all duration-200`,children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"cursor-move text-orange-600 hover:text-orange-500",children:e.jsx(xt,{className:"w-5 h-5"})}),e.jsx("div",{className:"text-sm font-medium text-orange-700 w-8",children:s.order_index}),e.jsx("div",{className:"flex-shrink-0",children:_(s.content_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-900 truncate",children:s.title}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:y(s.content_type)})]}),s.duration_minutes&&e.jsxs("p",{className:"text-sm text-orange-600 mt-1",children:["ระยะเวลา: ",s.duration_minutes," นาที"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>o(s),className:"text-blue-500 hover:bg-blue-50",title:"ดูตัวอย่าง",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>a(s),className:"text-green-500 hover:bg-green-50",title:"แก้ไข",children:e.jsx(ht,{className:"w-4 h-4"})}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>l(s.id),className:"text-red-500 hover:bg-red-50",title:"ลบ",children:e.jsx(Q,{className:"w-4 h-4"})})]})]})})},ys=()=>{const{courseId:s}=Me(),{isAdmin:t}=Ve(),{toast:r}=ee(),[a,l]=g.useState(null),[o,i]=g.useState([]),[w,u]=g.useState(!0),[x,_]=g.useState(!1),[y,p]=g.useState(null),[k,P]=g.useState("create"),T=g.useCallback((C,n)=>{const U=o[C],q=[...o];q.splice(C,1),q.splice(n,0,U),i(q)},[o]),j=g.useCallback(async()=>{u(!0);try{const{data:C,error:n}=await zt(s);if(n)throw n;l(C);const{data:U,error:q}=await Xt(s);if(q)throw q;i(U||[])}catch(C){console.error("Error loading course data:",C),r({title:"ไม่สามารถโหลดข้อมูลได้",description:C.message,variant:"destructive"})}finally{u(!1)}},[s,r]);g.useEffect(()=>{t&&j()},[t,j]);const b=g.useCallback(async()=>{const C=o.map((n,U)=>({...n,order_index:U+1}));try{const{error:n}=await js(s,C);if(n)throw n;r({title:"เรียงลำดับใหม่แล้ว",description:"ลำดับเนื้อหาได้รับการปรับปรุงแล้ว"})}catch(n){console.error("Error reordering content:",n),r({title:"ไม่สามารถเรียงลำดับได้",description:n.message,variant:"destructive"}),j()}},[o,s,r,j]),h=()=>{p(null),P("create"),_(!0)},m=C=>{p(C),P("edit"),_(!0)},S=async C=>{if(confirm("คุณแน่ใจหรือไม่ที่จะลบเนื้อหานี้?"))try{const{error:n}=await bs(C);if(n)throw n;r({title:"ลบเนื้อหาสำเร็จ",description:"เนื้อหาได้ถูกลบออกจากระบบแล้ว"}),j()}catch(n){console.error("Error deleting content:",n),r({title:"ไม่สามารถลบเนื้อหาได้",description:n.message,variant:"destructive"})}},N=async C=>{try{let n;if(k==="create"?n=await ps({...C,course_id:s,order_index:o.length+1}):n=await fs(y.id,C),n.error)throw n.error;r({title:k==="create"?"สร้างเนื้อหาสำเร็จ":"อัปเดตเนื้อหาสำเร็จ",description:"เนื้อหาได้รับการบันทึกแล้ว"}),_(!1),j()}catch(n){console.error("Error saving content:",n),r({title:"ไม่สามารถบันทึกได้",description:n.message,variant:"destructive"})}};return t?w?e.jsx("div",{className:"container mx-auto px-4 py-12",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-orange-700",children:"กำลังโหลดข้อมูลเนื้อหา..."})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-12",children:[e.jsx(he,{children:e.jsx("title",{children:a!=null&&a.title?`จัดการเนื้อหาคอร์ส - ${a.title} | Admin`:"จัดการเนื้อหาคอร์ส | Admin"})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx(te,{to:"/admin/courses",children:e.jsx(E,{variant:"ghost",size:"icon",children:e.jsx(je,{className:"w-5 h-5"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-orange-900",children:"จัดการเนื้อหาคอร์ส"}),e.jsx("p",{className:"text-orange-700",children:a==null?void 0:a.title}),a&&e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.is_active?"bg-green-500/30 text-green-700":"bg-red-500/30 text-red-700"}`,children:a.is_active?"เปิดใช้งาน":"ปิดใช้งาน"}),!a.is_active&&e.jsx("span",{className:"text-xs text-red-600 bg-red-50 px-2 py-1 rounded-full",children:"⚠️ คอร์สนี้ถูกปิดใช้งาน - สามารถแก้ไขเนื้อหาได้แต่ผู้ใช้ทั่วไปจะไม่เห็น"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-orange-700",children:["เนื้อหาทั้งหมด: ",o.length," รายการ"]}),e.jsxs(E,{onClick:h,className:"bg-blue-500 hover:bg-blue-600",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"เพิ่มเนื้อหาใหม่"]})]})]}),e.jsx(ct,{backend:dt,children:e.jsx("div",{className:"space-y-4",children:o.length===0?e.jsxs("div",{className:"glass-effect p-12 rounded-xl text-center",children:[e.jsx(K,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-orange-900 mb-2",children:"ยังไม่มีเนื้อหา"}),e.jsx("p",{className:"text-orange-700 mb-4",children:"เริ่มสร้างเนื้อหาแรกของคอร์สนี้"}),e.jsxs(E,{onClick:h,children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"เพิ่มเนื้อหาใหม่"]})]}):o.map((C,n)=>e.jsx(Ns,{content:C,index:n,moveContent:T,onEdit:m,onDelete:S,onTogglePreview:U=>{window.open(`/courses/${s}/learn`,"_blank")},onDragEnd:b},C.id))})}),e.jsx(ge,{children:x&&e.jsx(ws,{mode:k,content:y,onSave:N,onClose:()=>_(!1)})})]}):e.jsx("div",{className:"container mx-auto px-4 py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-orange-900 mb-2",children:"ไม่มีสิทธิ์เข้าถึง"}),e.jsx("p",{className:"text-orange-700",children:"หน้านี้สำหรับผู้ดูแลระบบเท่านั้น"})]})})},Zs=Object.freeze(Object.defineProperty({__proto__:null,default:ys},Symbol.toStringTag,{value:"Module"})),_s=({submission:s,assignment:t,onGrade:r})=>{var y,p;const a=s.score!==null,l=s.is_late,o=new Date(s.submitted_at),i=l&&t.due_date?Math.ceil((o-new Date(t.due_date))/(1e3*60*60*24)):0,w=async(k,P)=>{try{const{data:T,error:j}=await d.storage.from("course-files").download(P);if(j)throw j;const b=URL.createObjectURL(T),h=document.createElement("a");h.href=b,h.download=k,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(b)}catch(T){console.error("Download error:",T),alert("ไม่สามารถดาวน์โหลดไฟล์ได้")}},u=()=>a?"text-green-400":l?"text-red-400":"text-yellow-400",x=()=>a?e.jsx(Se,{className:"w-4 h-4"}):l?e.jsx(be,{className:"w-4 h-4"}):e.jsx(re,{className:"w-4 h-4"}),_=()=>a?`ให้คะแนนแล้ว (${s.score}/${t.max_score})`:l?`ส่งช้า ${i} วัน`:"รอให้คะแนน";return e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass-effect p-6 rounded-xl hover:bg-slate-700/30 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center mr-3",children:e.jsx(Oe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:((y=s.user_profiles)==null?void 0:y.full_name)||"ไม่ระบุชื่อ"}),e.jsx("p",{className:"text-sm text-slate-400",children:((p=s.user_profiles)==null?void 0:p.email)||"ไม่ระบุอีเมล"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-slate-400",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"ส่งเมื่อ: ",o.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:`flex items-center text-sm ${u()}`,children:[x(),e.jsx("span",{className:"ml-2",children:_()})]})]}),s.notes&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"bg-slate-700/50 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(bt,{className:"w-4 h-4 text-slate-400 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-1",children:"หมายเหตุจากนักเรียน:"}),e.jsx("p",{className:"text-sm text-slate-400",children:s.notes})]})]})})}),s.file_paths&&s.file_paths.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 mb-2",children:"ไฟล์ที่ส่ง:"}),e.jsx("div",{className:"space-y-2",children:s.file_paths.map((k,P)=>{const T=k.split("/").pop();return e.jsxs("div",{className:"flex items-center justify-between bg-slate-700/50 p-2 rounded",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"w-4 h-4 text-blue-400 mr-2"}),e.jsx("span",{className:"text-sm text-slate-300",children:T})]}),e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>w(T,k),className:"text-blue-400 hover:text-blue-300",children:e.jsx(_e,{className:"w-4 h-4"})})]},P)})})]}),a&&s.feedback&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"bg-green-500/10 border border-green-500/20 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(oe,{className:"w-4 h-4 text-green-400 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-300 mb-1",children:"ความคิดเห็นจากอาจารย์:"}),e.jsx("p",{className:"text-sm text-green-200",children:s.feedback})]})]})})})]}),e.jsxs("div",{className:"ml-6 flex flex-col space-y-2",children:[e.jsxs(E,{onClick:r,className:`${a?"bg-blue-500 hover:bg-blue-600":"bg-green-500 hover:bg-green-600"}`,children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),a?"แก้ไขคะแนน":"ให้คะแนน"]}),s.file_paths&&s.file_paths.length>0&&e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>{s.file_paths.forEach(k=>{const P=k.split("/").pop();w(P,k)})},children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"ดาวน์โหลดทั้งหมด"]})]})]}),a&&e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{className:"w-5 h-5 text-yellow-400 mr-2"}),e.jsx("span",{className:"text-sm text-slate-400",children:"คะแนน:"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-2xl font-bold text-white mr-1",children:s.score}),e.jsxs("span",{className:"text-lg text-slate-400",children:["/ ",t.max_score]}),e.jsxs("span",{className:"ml-2 text-sm text-slate-400",children:["(",Math.round(s.score/t.max_score*100),"%)"]})]})]})})]})},Cs=({submission:s,assignment:t,onSave:r,onClose:a})=>{var P,T;const{toast:l}=ee(),[o,i]=g.useState({score:s.score||"",feedback:s.feedback||"",grading_rubric_scores:s.grading_rubric_scores||{}}),[w,u]=g.useState(!1),x=["งานดีมาก! เข้าใจเนื้อหาอย่างถ่องแท้","งานดี แต่ยังมีจุดที่ต้องปรับปรุง","เป็นการทำงานที่ดี คิดวิเคราะห์ได้ดี","งานมีคุณภาพ แต่ควรใส่ใจในรายละเอียดมากขึ้น","ควรศึกษาเพิ่มเติมและปรับปรุงในครั้งต่อไป","งานยังไม่ตรงตามที่กำหนด กรุณาทำใหม่"],_=async j=>{if(j.preventDefault(),!o.score||o.score===""){l({title:"กรุณาใส่คะแนน",variant:"destructive"});return}const b=parseFloat(o.score);if(isNaN(b)||b<0||b>t.max_score){l({title:"คะแนนไม่ถูกต้อง",description:`คะแนนต้องอยู่ระหว่าง 0-${t.max_score}`,variant:"destructive"});return}u(!0);try{await r({...o,score:b,graded_at:new Date().toISOString(),graded_by:"admin"})}catch(h){console.error("Grading error:",h)}finally{u(!1)}},y=async(j,b)=>{try{const{data:h,error:m}=await d.storage.from("course-files").download(b);if(m)throw m;const S=URL.createObjectURL(h),N=document.createElement("a");N.href=S,N.download=j,document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(S)}catch(h){console.error("Download error:",h),l({title:"ไม่สามารถดาวน์โหลดไฟล์ได้",variant:"destructive"})}},p=j=>{const b=j/t.max_score*100;return b>=80?"text-green-400":b>=70?"text-yellow-400":b>=60?"text-orange-400":"text-red-400"},k=j=>{const b=j/t.max_score*100;return b>=80?"A":b>=70?"B":b>=60?"C":b>=50?"D":"F"};return e.jsx(R.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:a,children:e.jsxs(R.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"glass-effect rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",onClick:j=>j.stopPropagation(),children:[e.jsx("div",{className:"p-6 border-b border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"ให้คะแนนงานมอบหมาย"}),e.jsx("p",{className:"text-slate-400 mt-1",children:t.title})]}),e.jsx(E,{variant:"ghost",size:"icon",onClick:a,children:e.jsx(le,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row h-full max-h-[calc(90vh-88px)]",children:[e.jsxs("div",{className:"lg:w-1/2 p-6 border-r border-white/10 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center mr-3",children:e.jsx(Oe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:((P=s.user_profiles)==null?void 0:P.full_name)||"ไม่ระบุชื่อ"}),e.jsx("p",{className:"text-sm text-slate-400",children:(T=s.user_profiles)==null?void 0:T.email})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-slate-400",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"ส่งเมื่อ: ",new Date(s.submitted_at).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]}),s.is_late&&e.jsxs("div",{className:"flex items-center text-sm text-red-400",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"ส่งช้า"]})]})]}),s.notes&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"หมายเหตุจากนักเรียน:"}),e.jsx("div",{className:"bg-slate-700/50 p-3 rounded-lg",children:e.jsx("p",{className:"text-sm text-slate-300",children:s.notes})})]}),s.file_paths&&s.file_paths.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"ไฟล์ที่ส่ง:"}),e.jsx("div",{className:"space-y-2",children:s.file_paths.map((j,b)=>{const h=j.split("/").pop();return e.jsxs("div",{className:"flex items-center justify-between bg-slate-700/50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"w-4 h-4 text-blue-400 mr-2"}),e.jsx("span",{className:"text-sm text-slate-300",children:h})]}),e.jsx(E,{size:"sm",variant:"ghost",onClick:()=>y(h,j),className:"text-blue-400 hover:text-blue-300",children:e.jsx(_e,{className:"w-4 h-4"})})]},b)})})]}),e.jsxs("div",{className:"bg-slate-700/30 p-4 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-300 mb-2",children:"รายละเอียดงาน:"}),e.jsx("p",{className:"text-sm text-slate-400 mb-3",children:t.instructions}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"คะแนนเต็ม:"}),e.jsxs("span",{className:"text-white font-semibold",children:[t.max_score," คะแนน"]})]})]})]}),e.jsx("div",{className:"lg:w-1/2 p-6 overflow-y-auto",children:e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"คะแนน *"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"number",min:"0",max:t.max_score,step:"0.5",value:o.score,onChange:j=>i(b=>({...b,score:j.target.value})),className:"w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white text-center text-xl font-bold",placeholder:"0",required:!0})}),e.jsxs("div",{className:"text-xl text-slate-400",children:["/ ",t.max_score]}),o.score&&e.jsx("div",{className:`text-lg font-bold ${p(parseFloat(o.score))}`,children:k(parseFloat(o.score))})]}),o.score&&e.jsx("div",{className:"mt-2 text-center",children:e.jsxs("span",{className:`text-sm ${p(parseFloat(o.score))}`,children:[Math.round(parseFloat(o.score)/t.max_score*100),"%"]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"คะแนนด่วน:"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[25,50,75,100].map(j=>{const b=Math.round(j/100*t.max_score);return e.jsxs(E,{type:"button",variant:"outline",size:"sm",onClick:()=>i(h=>({...h,score:b.toString()})),className:"text-xs",children:[j,"%"]},j)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"ความคิดเห็น/คำแนะนำ"}),e.jsx("textarea",{value:o.feedback,onChange:j=>i(b=>({...b,feedback:j.target.value})),className:"w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white resize-none",rows:6,placeholder:"ให้คำแนะนำและความคิดเห็นเกี่ยวกับงานของนักเรียน..."})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"ความคิดเห็นด่วน:"}),e.jsx("div",{className:"space-y-2",children:x.map((j,b)=>e.jsx("button",{type:"button",onClick:()=>i(h=>({...h,feedback:h.feedback?`${h.feedback}

${j}`:j})),className:"w-full text-left p-2 text-xs bg-slate-700/50 hover:bg-slate-700 rounded text-slate-300 hover:text-white transition-colors",children:j},b))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-white/10",children:[e.jsx(E,{type:"button",variant:"outline",onClick:a,children:"ยกเลิก"}),e.jsx(E,{type:"submit",className:"bg-green-500 hover:bg-green-600",disabled:w,children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"กำลังบันทึก..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"บันทึกคะแนน"]})})]})]})})]})]})})},Ss=()=>{const{assignmentId:s}=Me(),{toast:t}=ee(),[r,a]=g.useState(null),[l,o]=g.useState([]),[i,w]=g.useState(!0),[u,x]=g.useState(""),[_,y]=g.useState("all"),[p,k]=g.useState(null),[P,T]=g.useState(!1),j=g.useCallback(async()=>{w(!0);try{const{data:N,error:C}=await Jt(s);if(C)throw C;a(N);const{data:n,error:U}=await Ht(s);if(U)throw U;o(n||[])}catch(N){t({title:"ข้อผิดพลาดในการโหลดข้อมูล",description:N.message,variant:"destructive"})}finally{w(!1)}},[s,t]);g.useEffect(()=>{j()},[j]);const b=N=>{k(N),T(!0)},h=async N=>{try{const{error:C}=await Kt(p.id,N);if(C)throw C;t({title:"บันทึกคะแนนสำเร็จ",description:`ให้คะแนน ${N.score}/${r.max_score} คะแนน`}),j(),T(!1),k(null)}catch(C){t({title:"ไม่สามารถบันทึกคะแนนได้",description:C.message,variant:"destructive"})}},m=l.filter(N=>{var U,q;const C=((q=(U=N.user_profiles)==null?void 0:U.full_name)==null?void 0:q.toLowerCase().includes(u.toLowerCase()))||!1,n=_==="all"||_==="graded"&&N.score!==null||_==="ungraded"&&N.score===null||_==="late"&&N.is_late;return C&&n}),S={total:l.length,graded:l.filter(N=>N.score!==null).length,ungraded:l.filter(N=>N.score===null).length,average:l.length>0&&Math.round(l.filter(N=>N.score!==null).reduce((N,C)=>N+(C.score||0),0)/l.filter(N=>N.score!==null).length)||0};return i?e.jsx("div",{className:"container mx-auto px-4 py-12",children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-slate-400",children:"กำลังโหลดข้อมูล..."})]})}):e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"container mx-auto px-4 py-12",children:[e.jsx(he,{children:e.jsx("title",{children:"ให้คะแนนงานมอบหมาย - ผู้ดูแลระบบ Login Learning"})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(te,{to:"/admin/courses",className:"text-slate-400 hover:text-white transition-colors mr-4",children:e.jsx(je,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"ให้คะแนนงานมอบหมาย"})]}),r&&e.jsx("div",{className:"glass-effect p-6 rounded-xl",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:r.title}),e.jsx("p",{className:"text-slate-400 mb-4",children:r.description}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-slate-400",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"คะแนนเต็ม: ",r.max_score]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"w-4 h-4 mr-1"}),"กำหนดส่ง: ",r.due_date?new Date(r.due_date).toLocaleDateString("th-TH"):"ไม่ระบุ"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{className:"w-4 h-4 mr-1"}),"ส่งงานแล้ว: ",S.total," คน"]})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"glass-effect p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"งานทั้งหมด"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:S.total})]}),e.jsx(K,{className:"w-8 h-8 text-blue-400"})]})}),e.jsx("div",{className:"glass-effect p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"ให้คะแนนแล้ว"}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:S.graded})]}),e.jsx(Se,{className:"w-8 h-8 text-green-400"})]})}),e.jsx("div",{className:"glass-effect p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"รอให้คะแนน"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:S.ungraded})]}),e.jsx(W,{className:"w-8 h-8 text-yellow-400"})]})}),e.jsx("div",{className:"glass-effect p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"คะแนนเฉลี่ย"}),e.jsx("p",{className:"text-2xl font-bold text-purple-400",children:S.average})]}),e.jsx(oe,{className:"w-8 h-8 text-purple-400"})]})})]}),e.jsx("div",{className:"glass-effect p-4 rounded-lg mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx(O,{type:"text",placeholder:"ค้นหาชื่อนักเรียน...",value:u,onChange:N=>x(N.target.value),className:"pl-10 bg-slate-700/50 border-slate-600 text-white"})]})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsxs("select",{value:_,onChange:N=>y(N.target.value),className:"w-full p-2 bg-slate-700 border border-slate-600 rounded-lg text-white",children:[e.jsx("option",{value:"all",children:"ทั้งหมด"}),e.jsx("option",{value:"ungraded",children:"รอให้คะแนน"}),e.jsx("option",{value:"graded",children:"ให้คะแนนแล้ว"}),e.jsx("option",{value:"late",children:"ส่งช้า"})]})})]})}),e.jsx("div",{className:"space-y-4",children:m.length===0?e.jsxs("div",{className:"glass-effect p-8 rounded-lg text-center",children:[e.jsx(K,{className:"w-12 h-12 text-slate-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400 text-lg",children:u||_!=="all"?"ไม่พบงานที่ตรงกับเงื่อนไขการค้นหา":"ยังไม่มีนักเรียนส่งงาน"})]}):m.map(N=>e.jsx(_s,{submission:N,assignment:r,onGrade:()=>b(N)},N.id))}),e.jsx(ge,{children:P&&p&&e.jsx(Cs,{submission:p,assignment:r,onSave:h,onClose:()=>{T(!1),k(null)}})})]})},Ys=Object.freeze(Object.defineProperty({__proto__:null,default:Ss},Symbol.toStringTag,{value:"Module"})),Es=()=>{const{toast:s}=ee(),t=Ce(),r=jt(),[a,l]=g.useState(""),[o,i]=g.useState([]),[w,u]=g.useState(!0),[x,_]=g.useState(null),[y,p]=g.useState(!1),k=g.useCallback(async()=>{u(!0);const{data:n,error:U}=await ls();U?s({title:"ข้อผิดพลาดในการโหลดข้อมูล",description:U.message,variant:"destructive"}):i(n||[]),u(!1)},[s]),P=g.useCallback(async()=>{const{data:n,error:U}=await os();!U&&n&&_(n)},[]);g.useEffect(()=>{var n;console.log("AdminProjectsPage mounted"),k(),P(),(n=r.state)!=null&&n.openCreateModal&&(console.log("Opening create modal from navigation state"),p(!0),t(r.pathname,{replace:!0}))},[k,P,r.state,t,r.pathname]),g.useEffect(()=>{console.log("Current state:",{loading:w,projects:o.length,showCreateForm:y,stats:x})},[w,o,y,x]);const T=async(n,U,q)=>{const L=!q,I=L?"อนุมัติ":"ไม่อนุมัติ";if(!confirm(`คุณแน่ใจหรือไม่ที่จะ${I}โครงงาน "${U}"?`))return;const{error:c}=await rs(n,L);c?s({title:`ไม่สามารถ${I}โครงงานได้`,description:c.message,variant:"destructive"}):(s({title:`${I}โครงงานสำเร็จ`,description:`โครงงาน "${U}" ถูก${I}แล้ว`}),k(),P())},j=async(n,U,q)=>{const L=!q,I=L?"เพิ่มในแนะนำ":"ลบจากแนะนำ",{error:c}=await as(n,L);c?s({title:`ไม่สามารถ${I}ได้`,description:c.message,variant:"destructive"}):(s({title:`${I}สำเร็จ`,description:`โครงงาน "${U}" ถูก${I}แล้ว`}),k(),P())},b=async(n,U)=>{if(!confirm(`คุณแน่ใจหรือไม่ที่จะลบโครงงาน "${U}"?

การลบนี้จะเป็นการลบชั่วคราว สามารถกู้คืนได้`))return;const{error:q}=await ss(n);q?s({title:"ไม่สามารถลบโครงงานได้",description:q.message,variant:"destructive"}):(s({title:"ลบโครงงานสำเร็จ",description:`โครงงาน "${U}" ถูกลบเรียบร้อยแล้ว`}),k(),P())},h=()=>{k(),P()},m=n=>{s({title:"ฟีเจอร์ยังไม่พร้อมใช้งาน",description:`${n} ยังอยู่ในระหว่างการพัฒนา`,variant:"info"})},S=n=>new Date(n).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric"}),N=o.filter(n=>{var U,q;return n.title.toLowerCase().includes(a.toLowerCase())||((U=n.category)==null?void 0:U.toLowerCase().includes(a.toLowerCase()))||((q=n.technologies)==null?void 0:q.some(L=>L.toLowerCase().includes(a.toLowerCase())))}),C={initial:{opacity:0,y:20},in:{opacity:1,y:0},out:{opacity:0,y:-20}};return e.jsxs(R.div,{initial:"initial",animate:"in",exit:"out",variants:C,className:"container mx-auto px-4 py-12",children:[e.jsxs(he,{children:[e.jsx("title",{children:"จัดการโครงงาน - ผู้ดูแลระบบ Login Learning"}),e.jsx("meta",{name:"description",content:"จัดการโครงงานและผลงานทั้งหมดในระบบ Login Learning"})]}),e.jsxs(R.div,{initial:{y:-30,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,delay:.1},className:"flex flex-col sm:flex-row justify-between items-center mb-10",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(E,{variant:"ghost",size:"sm",onClick:()=>t("/admin"),className:"mr-4 text-gray-600 hover:text-gray-900",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"ย้อนกลับ"]}),e.jsxs("h1",{className:"text-3xl lg:text-4xl font-bold text-purple-900 mb-4 sm:mb-0",children:[e.jsx(se,{className:"inline-block w-8 h-8 mr-3 text-[#667eea]"}),"จัดการโครงงาน"]})]}),e.jsxs(E,{onClick:()=>{console.log("Create project button clicked"),p(!0)},className:"bg-gradient-to-r from-[#667eea] to-[#764ba2] hover:from-[#5a6fcf] hover:to-[#673f8b] text-white font-semibold shadow-lg",size:"lg",children:[e.jsx(we,{className:"w-5 h-5 mr-2"}),"เพิ่มโครงงานใหม่"]})]}),x&&e.jsxs(R.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,delay:.2},className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"glass-effect p-6 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-700 text-sm",children:"โครงงานทั้งหมด"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:x.totalProjects})]}),e.jsx(se,{className:"w-8 h-8 text-[#667eea]"})]})}),e.jsx("div",{className:"glass-effect p-6 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-700 text-sm",children:"โครงงานแนะนำ"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:x.featuredProjects})]}),e.jsx(ue,{className:"w-8 h-8 text-yellow-400 fill-current"})]})}),e.jsx("div",{className:"glass-effect p-6 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-700 text-sm",children:"หมวดหมู่"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:x.totalCategories})]}),e.jsx(pe,{className:"w-8 h-8 text-green-400"})]})}),e.jsx("div",{className:"glass-effect p-6 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-700 text-sm",children:"การมองเห็น"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:"--"})]}),e.jsx(ve,{className:"w-8 h-8 text-blue-400"})]})})]}),e.jsx("div",{className:"mb-6 glass-effect p-4 rounded-xl",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(O,{type:"text",placeholder:"ค้นหาโครงงาน (ชื่อ, หมวดหมู่, เทคโนโลยี)...",value:a,onChange:n=>l(n.target.value),className:"pl-10 w-full bg-slate-200 border-slate-400 text-gray-900 focus:border-[#667eea]"})]}),e.jsxs(E,{onClick:()=>{console.log("Search area create button clicked"),p(!0)},className:"bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"เพิ่มโครงงาน"]})]})}),e.jsxs("div",{className:"glass-effect rounded-xl shadow-xl overflow-x-auto",children:[w?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#667eea] mx-auto mb-4"}),e.jsx("p",{className:"text-purple-700",children:"กำลังโหลดข้อมูลโครงงาน..."})]}):e.jsxs("table",{className:"w-full min-w-max text-left text-purple-800",children:[e.jsx("thead",{className:"border-b border-slate-700",children:e.jsxs("tr",{className:"bg-purple-100/30",children:[e.jsx("th",{className:"p-4",children:"โครงงาน"}),e.jsx("th",{className:"p-4",children:"หมวดหมู่"}),e.jsx("th",{className:"p-4",children:"เทคโนโลยี"}),e.jsx("th",{className:"p-4",children:"สถานะ"}),e.jsx("th",{className:"p-4",children:"แนะนำ"}),e.jsx("th",{className:"p-4",children:"วันที่สร้าง"}),e.jsx("th",{className:"p-4 text-center",children:"การดำเนินการ"})]})}),e.jsx("tbody",{children:N.map((n,U)=>{var q,L;return e.jsxs(R.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:U*.05},className:"border-b border-slate-700/50 hover:bg-slate-700/20 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[n.image_url&&e.jsx("img",{src:n.image_url,alt:n.title,className:"w-12 h-12 object-cover rounded-lg",onError:I=>{I.target.style.display="none"}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-purple-900",children:n.title}),e.jsx("p",{className:"text-sm text-purple-700 truncate max-w-xs",children:n.description||"ไม่มีคำอธิบาย"})]})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-500/30 text-blue-800",children:n.category||"ไม่ระบุ"})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-32",children:[(q=n.technologies)==null?void 0:q.slice(0,2).map((I,c)=>e.jsx("span",{className:"px-2 py-1 text-xs rounded bg-gray-100 text-gray-700",children:I},c)),((L=n.technologies)==null?void 0:L.length)>2&&e.jsxs("span",{className:"px-2 py-1 text-xs rounded bg-gray-100 text-gray-700",children:["+",n.technologies.length-2]})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${n.is_approved?"bg-green-500/30 text-green-800":"bg-red-500/30 text-red-800"}`,children:n.is_approved?"อนุมัติแล้ว":"รออนุมัติ"})}),e.jsx("td",{className:"p-4",children:e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>j(n.id,n.title,n.is_featured),className:n.is_featured?"text-yellow-500 hover:bg-yellow-500/20":"text-gray-400 hover:bg-yellow-500/20",title:n.is_featured?"ลบจากแนะนำ":"เพิ่มในแนะนำ",children:n.is_featured?e.jsx(ue,{className:"w-4 h-4 fill-current"}):e.jsx(vt,{className:"w-4 h-4"})})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(me,{className:"w-4 h-4 mr-1"}),S(n.created_at)]})}),e.jsx("td",{className:"p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[n.demo_url&&e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>window.open(n.demo_url,"_blank"),className:"text-green-400 hover:bg-green-500/20",title:"ดูเดโม",children:e.jsx(wt,{className:"w-4 h-4"})}),n.github_url&&e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>window.open(n.github_url,"_blank"),className:"text-gray-400 hover:bg-gray-500/20",title:"ดู GitHub",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>m(`แก้ไขโครงงาน ${n.title}`),className:"text-blue-400 hover:bg-blue-500/20",title:"แก้ไขโครงงาน",children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>T(n.id,n.title,n.is_approved),className:n.is_approved?"text-orange-400 hover:bg-orange-500/20":"text-green-400 hover:bg-green-500/20",title:n.is_approved?"ไม่อนุมัติ":"อนุมัติ",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>b(n.id,n.title),className:"text-red-400 hover:bg-red-500/20",title:"ลบโครงงาน",children:e.jsx(Q,{className:"w-4 h-4"})})]})})]},n.id)})})]}),!w&&N.length===0&&e.jsxs("div",{className:"text-center p-8",children:[e.jsx(be,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),e.jsx("p",{className:"text-purple-700 text-lg",children:"ไม่พบโครงงานที่ตรงกับการค้นหา"}),e.jsx("p",{className:"text-purple-600 text-sm mt-2",children:"ลองปรับเปลี่ยนคำค้นหาหรือเพิ่มโครงงานใหม่"})]})]}),e.jsx(ns,{isOpen:y,onClose:()=>p(!1),onSuccess:h})]})},Qs=Object.freeze(Object.defineProperty({__proto__:null,default:Es},Symbol.toStringTag,{value:"Module"}));export{As as A,E as B,ns as C,Hs as D,Ks as E,Xs as F,Zs as G,Ys as H,O as I,Qs as J,Ts as T,Ve as a,qt as b,Wt as c,Vt as d,Ls as e,zs as f,Ds as g,Is as h,Rs as i,Gt as j,Xt as k,Ae as l,Ws as m,De as n,Js as o,Gs as p,Vs as q,Bs as r,d as s,Ge as t,ee as u,$s as v,Fs as w,Os as x,qs as y,Ms as z};
