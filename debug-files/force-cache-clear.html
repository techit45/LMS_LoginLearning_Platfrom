<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏•‡πâ‡∏≤‡∏á Cache ‡πÅ‡∏•‡∏∞‡∏ó‡∏î‡∏™‡∏≠‡∏ö</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        .button {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        .button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        .danger {
            background: #f44336;
        }
        .danger:hover {
            background: #da190b;
        }
        .success {
            background: #2196F3;
        }
        .success:hover {
            background: #0b7dda;
        }
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error { background: rgba(244, 67, 54, 0.2); }
        .success { background: rgba(76, 175, 80, 0.2); }
        .warning { background: rgba(255, 193, 7, 0.2); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßπ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏•‡πâ‡∏≤‡∏á Cache ‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå</h1>
        
        <div class="status warning">
            <h3>‚ö†Ô∏è ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö:</h3>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô "‡∏Ñ‡∏≠‡∏£‡πå‡∏™ AI ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1") ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏£‡πå‡∏™</p>
        </div>

        <div class="status success">
            <h3>‚úÖ ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß:</h3>
            <ul>
                <li>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç contentService.js</li>
                <li>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ContentEditor.jsx</li>
                <li>Rebuild application</li>
                <li>Deploy Supabase Edge Function</li>
            </ul>
        </div>

        <h2>üîß ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h2>
        
        <button class="button danger" onclick="clearAllCache()">
            üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á Cache ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </button>
        
        <button class="button success" onclick="forceReload()">
            üîÑ Reload ‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö
        </button>
        
        <button class="button" onclick="checkCacheStatus()">
            üìä ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Cache
        </button>
        
        <button class="button" onclick="testFolderCreation()">
            üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
        </button>

        <div id="log" class="log"></div>
        
        <div class="status warning">
            <h3>üìã ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</h3>
            <ol>
                <li>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏•‡πâ‡∏≤‡∏á Cache ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"</li>
                <li>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "Reload ‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö"</li>
                <li>‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡πÉ‡∏´‡∏°‡πà‡∏ä‡∏∑‡πà‡∏≠ "‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏ó‡∏î‡∏™‡∏≠‡∏ö Final"</li>
                <li>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö"</li>
                <li>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</li>
                <li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô Google Drive ‡∏ß‡πà‡∏≤‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</li>
            </ol>
        </div>
    </div>

    <script>
        const log = document.getElementById('log');
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('th-TH');
            const emoji = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            log.textContent += `[${timestamp}] ${emoji} ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }

        async function clearAllCache() {
            addLog('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡πâ‡∏≤‡∏á Cache ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î...', 'info');
            
            try {
                // Clear localStorage
                localStorage.clear();
                addLog('‡∏•‡πâ‡∏≤‡∏á localStorage ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                
                // Clear sessionStorage
                sessionStorage.clear();
                addLog('‡∏•‡πâ‡∏≤‡∏á sessionStorage ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                
                // Clear Service Workers
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (let registration of registrations) {
                        await registration.unregister();
                    }
                    addLog(`‡∏•‡πâ‡∏≤‡∏á Service Workers (${registrations.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`, 'success');
                }
                
                // Clear Caches API
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(
                        cacheNames.map(cacheName => caches.delete(cacheName))
                    );
                    addLog(`‡∏•‡πâ‡∏≤‡∏á Caches API (${cacheNames.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`, 'success');
                }
                
                addLog('‡∏•‡πâ‡∏≤‡∏á Cache ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ', 'success');
                
            } catch (error) {
                addLog(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            }
        }

        function forceReload() {
            addLog('‡∏Å‡∏≥‡∏•‡∏±‡∏á Reload ‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö...', 'info');
            // Force reload without cache
            window.location.reload(true);
        }

        async function checkCacheStatus() {
            addLog('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Cache...', 'info');
            
            // Check localStorage
            const localStorageSize = JSON.stringify(localStorage).length;
            addLog(`localStorage: ${localStorageSize} bytes`, localStorageSize > 0 ? 'warning' : 'success');
            
            // Check sessionStorage
            const sessionStorageSize = JSON.stringify(sessionStorage).length;
            addLog(`sessionStorage: ${sessionStorageSize} bytes`, sessionStorageSize > 0 ? 'warning' : 'success');
            
            // Check Service Workers
            if ('serviceWorker' in navigator) {
                const registrations = await navigator.serviceWorker.getRegistrations();
                addLog(`Service Workers: ${registrations.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, registrations.length > 0 ? 'warning' : 'success');
            }
            
            // Check Caches API
            if ('caches' in window) {
                const cacheNames = await caches.keys();
                addLog(`Caches API: ${cacheNames.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, cacheNames.length > 0 ? 'warning' : 'success');
                cacheNames.forEach(name => addLog(`  - ${name}`, 'info'));
            }
            
            // Check if JavaScript is updated
            const scripts = document.querySelectorAll('script[src]');
            addLog(`Script files: ${scripts.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, 'info');
            
            addLog('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', 'success');
        }

        async function testFolderCreation() {
            addLog('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå...', 'info');
            
            const API_BASE = 'https://vuitwzisazvikrhtfthh.supabase.co/functions/v1/google-drive';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ1aXR3emlzYXp2aWtyaHRmdGhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzOTU4ODIsImV4cCI6MjA2Njk3MTg4Mn0.VXCqythCUualJ7S9jVvnQUYe9BKnfMvbihtZT5c3qyE';
            
            try {
                // Test Edge Function
                const response = await fetch(`${API_BASE}/health`, {
                    headers: {
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    addLog('Edge Function ‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á: ' + JSON.stringify(result), 'success');
                } else {
                    addLog(`Edge Function Error: ${response.status}`, 'error');
                }
                
                // Test create-topic-folder icons
                addLog('‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ:', 'info');
                addLog('  üìñ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏£‡πå‡∏™ (course)', 'info');
                addLog('  üîß ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ (project)', 'info');
                addLog('  üìö ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö course_content (‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ!)', 'warning');
                addLog('  üéì ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÉ‡∏ô Google Drive', 'error');
                
            } catch (error) {
                addLog(`‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
            }
        }

        // Auto-check status on load
        document.addEventListener('DOMContentLoaded', () => {
            addLog('üöÄ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'success');
            addLog('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πâ‡∏≤‡∏á Cache ‡πÅ‡∏•‡∏∞ Reload ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö', 'warning');
        });
    </script>
</body>
</html>